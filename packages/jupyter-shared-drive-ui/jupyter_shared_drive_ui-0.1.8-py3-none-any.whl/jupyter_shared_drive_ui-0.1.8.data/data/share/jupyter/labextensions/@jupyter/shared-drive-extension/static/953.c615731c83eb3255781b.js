"use strict";(self.webpackChunk_jupyter_shared_drive_extension=self.webpackChunk_jupyter_shared_drive_extension||[]).push([[953],{953:(e,t,r)=>{r.r(t),r.d(t,{IGlobalAwareness:()=>n,IUserMenu:()=>s,RendererUserMenu:()=>w,UserInfoBody:()=>P,UserInfoPanel:()=>R,UserMenu:()=>x,remoteUserCursors:()=>y});var o=r(262);const s=new o.Token("@jupyter/collaboration:IUserMenu"),n=new o.Token("@jupyter/collaboration:IGlobalAwareness");var a=r(195),i=r(24),l=r(206);const c=a.Facet.define({combine:e=>e[e.length-1]}),d=i.EditorView.baseTheme({".jp-remote-cursor":{borderLeft:"1px solid black",marginLeft:"-1px"},".jp-remote-cursor.jp-mod-primary":{borderLeftWidth:"2px"},".jp-remote-selection":{opacity:.5},".cm-tooltip":{border:"none"},".cm-tooltip .jp-remote-userInfo":{color:"var(--jp-ui-inverse-font-color0)",padding:"0px 2px"}}),u=a.Annotation.define();class h{constructor(e,t){this.style=e,this.marker=t}draw(){const e=this.marker.draw();for(const[t,r]of Object.entries(this.style))e.style[t]=r;return e}eq(e){return this.marker.eq(e.marker)&&o.JSONExt.deepEqual(this.style,e.style)}update(e,t){for(const[t,r]of Object.entries(this.style))e.style[t]=r;return this.marker.update(e,t.marker)}}const m=(0,i.layer)({above:!0,markers(e){const{awareness:t,ytext:r}=e.state.facet(c),o=r.doc,s=[];return t.getStates().forEach(((n,c)=>{var d,u,m;if(c===t.doc.clientID)return;const p=n.cursors;for(const t of null!=p?p:[]){if(!(null==t?void 0:t.anchor)||!(null==t?void 0:t.head))return;const c=(0,l.createAbsolutePositionFromRelativePosition)(t.anchor,o),p=(0,l.createAbsolutePositionFromRelativePosition)(t.head,o);if((null==c?void 0:c.type)!==r||(null==p?void 0:p.type)!==r)return;const f=null===(d=t.primary)||void 0===d||d?"jp-remote-cursor jp-mod-primary":"jp-remote-cursor",v=a.EditorSelection.cursor(p.index,p.index>c.index?-1:1);for(const t of i.RectangleMarker.forRange(e,f,v))s.push(new h({borderLeftColor:null!==(m=null===(u=n.user)||void 0===u?void 0:u.color)&&void 0!==m?m:"black"},t))}})),s},update:(e,t)=>!!e.transactions.find((e=>e.annotation(u))),class:"jp-remote-cursors"}),p=(0,i.hoverTooltip)(((e,t)=>{var r;const{awareness:o,ytext:s}=e.state.facet(c),n=s.doc;for(const[e,a]of o.getStates())if(e!==o.doc.clientID)for(const e of null!==(r=a.cursors)&&void 0!==r?r:[]){if(!(null==e?void 0:e.head))continue;const r=(0,l.createAbsolutePositionFromRelativePosition)(e.head,n);if((null==r?void 0:r.type)===s&&r.index-3<=t&&t<=r.index+3)return{pos:r.index,above:!0,create:()=>{var e,t,r,o;const s=document.createElement("div");return s.classList.add("jp-remote-userInfo"),s.style.backgroundColor=null!==(t=null===(e=a.user)||void 0===e?void 0:e.color)&&void 0!==t?t:"darkgrey",s.textContent=null!==(o=null===(r=a.user)||void 0===r?void 0:r.display_name)&&void 0!==o?o:"Anonymous",{dom:s}}}}return null}),{hideOn:(e,t)=>!!e.annotation(u),hoverTime:0}),f=(0,i.layer)({above:!1,markers(e){const{awareness:t,ytext:r}=e.state.facet(c),o=r.doc,s=[];return t.getStates().forEach(((n,c)=>{var d,u,m;if(c===t.doc.clientID)return;const p=n.cursors;for(const t of null!=p?p:[]){if(null===(d=t.empty)||void 0===d||d||!(null==t?void 0:t.anchor)||!(null==t?void 0:t.head))return;const c=(0,l.createAbsolutePositionFromRelativePosition)(t.anchor,o),p=(0,l.createAbsolutePositionFromRelativePosition)(t.head,o);if((null==c?void 0:c.type)!==r||(null==p?void 0:p.type)!==r)return;const f="jp-remote-selection";for(const t of i.RectangleMarker.forRange(e,f,a.EditorSelection.range(c.index,p.index)))s.push(new h({backgroundColor:null!==(m=null===(u=n.user)||void 0===u?void 0:u.color)&&void 0!==m?m:"black"},t))}})),s},update:(e,t)=>!!e.transactions.find((e=>e.annotation(u))),class:"jp-remote-selections"}),v=i.ViewPlugin.fromClass(class{constructor(e){this.editorAwareness=e.state.facet(c),this._listener=({added:t,updated:r,removed:o})=>{t.concat(r).concat(o).findIndex((e=>e!==this.editorAwareness.awareness.doc.clientID))>=0&&e.dispatch({annotations:[u.of([])]})},this.editorAwareness.awareness.on("change",this._listener)}destroy(){this.editorAwareness.awareness.off("change",this._listener)}update(e){var t;if(!e.docChanged&&!e.selectionSet)return;const{awareness:r,ytext:s}=this.editorAwareness,n=r.getLocalState();if(n){const a=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),i=e.state.selection,c=new Array;if(a&&i){for(const e of i.ranges){const t=e===i.main,r=(0,l.createRelativePositionFromTypeIndex)(s,e.anchor),o=(0,l.createRelativePositionFromTypeIndex)(s,e.head);c.push({anchor:r,head:o,primary:t,empty:e.empty})}if(!n.cursors||c.length>0){const e=null===(t=n.cursors)||void 0===t?void 0:t.map((e=>({...e,anchor:(null==e?void 0:e.anchor)?(0,l.createRelativePositionFromJSON)(e.anchor):null,head:(null==e?void 0:e.head)?(0,l.createRelativePositionFromJSON)(e.head):null})));o.JSONExt.deepEqual(c,e)||r.setLocalStateField("cursors",c)}}}}},{provide:()=>[d,m,f,p,(0,i.tooltips)({position:"absolute",parent:document.body})]});function y(e){return[c.of(e),v]}var b=r(460),_=r(256),I=r(873);class w extends _.MenuBar.Renderer{constructor(e){super(),this._user=e}renderItem(e){const t=this.createItemClass(e),r=this.createItemDataset(e),o=this.createItemARIA(e);return I.h.li({className:t,dataset:r,tabindex:"0",onfocus:e.onfocus,...o},this._createUserIcon(),this.renderLabel(e),this.renderIcon(e))}renderLabel(e){const t=this.formatLabel(e);return I.h.div({className:"lm-MenuBar-itemLabel jp-MenuBar-label"},t)}_createUserIcon(){return this._user.isReady&&this._user.identity.avatar_url?I.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-imageIcon"},I.h.img({src:this._user.identity.avatar_url})):this._user.isReady?I.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon",style:{backgroundColor:this._user.identity.color}},I.h.span({},this._user.identity.initials)):I.h.div({className:"lm-MenuBar-itemIcon jp-MenuBar-anonymousIcon"},b.userIcon)}}class x extends _.Menu{constructor(e){super(e)}}var g=r(200),j=r(345);const k=e=>{const{user:t}=e;return j.createElement("div",{className:"jp-UserInfo-Container"},j.createElement("div",{title:t.display_name,className:"jp-UserInfo-Icon",style:{backgroundColor:t.color}},j.createElement("span",null,t.initials)),j.createElement("h3",null,t.display_name))};class R extends _.Panel{constructor(e){super({}),this.addClass("jp-UserInfoPanel"),this._profile=e,this._body=null,this._profile.isReady?(this._body=new P(this._profile.identity),this.addWidget(this._body),this.update()):this._profile.ready.then((()=>{this._body=new P(this._profile.identity),this.addWidget(this._body),this.update()})).catch((e=>console.error(e)))}}class P extends g.ReactWidget{constructor(e){super(),this._user=e}get user(){return this._user}set user(e){this._user=e,this.update()}render(){return j.createElement(k,{user:this._user})}}}}]);