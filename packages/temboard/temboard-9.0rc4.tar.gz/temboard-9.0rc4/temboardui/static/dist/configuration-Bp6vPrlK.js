import{p as u,c as H,q as X,o as l,e as r,z as e,g as f,f as a,P as N,Z,s as K,k as I,F as b,A as k,h as x,U as Q,Y as W,S as R,V as ee,$ as te,a0 as oe,N as se}from"./vue-B9xKOMBJ.js";import{M as ae,P as U}from"./bootstrap.esm-BOBBXxos.js";import{$}from"./jquery-BALIvAru.js";import{_ as ne}from"./Error-Cz3nVgqD.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./highlight.js-CWp04Ajj.js";const re={class:"form-check form-switch"},ie=["for"],ce=["id","name"],de={__name:"SettingSwitch",props:["id","name","setting"],setup(m){const c=m,_=u(c.setting=="on"),g=H(()=>_.value?"on":"off");return X(c,()=>_.value=c.setting=="on"),(S,v)=>(l(),r("div",re,[e("label",{for:m.id},f(g.value),9,ie),a(),N(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:m.id,name:m.name,"onUpdate:modelValue":v[0]||(v[0]=p=>_.value=p)},null,8,ce),[[Z,_.value]])]))}},d=m=>(te("data-v-5c302b6d"),m=m(),oe(),m),ue={class:"modal fade",id:"resetModal",tabindex:"-1",role:"dialog","aria-labelledby":"resetModalLabel"},pe={class:"modal-dialog",role:"document"},me={class:"modal-content"},ve=d(()=>e("div",{class:"modal-header"},[e("h4",{class:"modal-title"},"Processing, please wait...")],-1)),fe=R('<div class="modal-body" data-v-5c302b6d><div class="row" data-v-5c302b6d><div class="col-4 offset-4" data-v-5c302b6d><div class="progress" data-v-5c302b6d><div class="progress-bar progress-bar-striped" style="width:100%;" data-v-5c302b6d>Please wait ...</div></div></div></div></div>',1),_e=d(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close")],-1)),be=d(()=>e("div",{class:"modal-header"},[e("h4",{class:"modal-title",id:"resetModalLabel"},"Reset parameter:"),a(),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),he={class:"modal-body",id:"resetModalBody"},ye={class:"modal-footer",id:"resetModalFooter"},ge=d(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),ke={key:0,class:"row"},$e={class:"col-12"},Ce={id:"alert-configuration",class:"alert alert-warning alert-dismissible",role:"alert"},xe=d(()=>e("p",null,"The options below will be applied after restart :",-1)),Se=["onClick"],Te=d(()=>e("span",{class:"fa fa-times","aria-hidden":"true"},null,-1)),je={class:"row mb-3"},Ee={class:"col-3 me-auto"},Me=d(()=>e("label",{class:"sr-only",for:"selectServer"},"Search",-1)),Pe={class:"input-group"},Ve=d(()=>e("i",{class:"fa fa-fw fa-times"},null,-1)),Le=[Ve],Ne=d(()=>e("i",{class:"fa fa-fw fa-search"},null,-1)),qe=[Ne],Be={class:"col-7"},Fe=d(()=>e("label",{class:"sr-only",for:"selectConfCat"},"Category",-1)),Ie={class:"input-group"},Ue=d(()=>e("div",{class:"input-group-text"},"Category",-1)),Ae=["disabled"],we=["value","selected"],De={class:"col-12"},Oe={class:"card"},Ye={class:"card-header"},Ge={class:"card-body"},Je={class:"table table-sm"},ze={class:"title-setting"},He={class:"text-body-secondary mb-0 small"},Xe={class:"input-setting"},Ze={key:0},Ke=["name","id"],Qe=["value","selected"],We=["data-bs-content","name","id","placeholder","value"],Re=["id","title","data-bs-content","onClick"],et=d(()=>e("span",{class:"fa fa-undo","aria-hidden":"true"},null,-1)),tt=d(()=>e("div",{class:"row"},[e("div",{class:"col-12 text-center"},[e("button",{type:"submit",class:"btn btn-sm btn-success"},"Save and reload configuration")])],-1)),ot={__name:"Configuration",props:["address","port"],setup(m){const c=m,_=u([]),g=u([]),S=u([]),v=u(""),p=u(""),T=u(null),C=u(!1),j=u(null),E=u(null),M=u(""),P=u("");let V;K(()=>{A(),V=new ae(document.getElementById("resetModal"))});function A(){$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration/categories`,type:"GET",async:!0,contentType:"application/json",dataType:"json",success:function(s){_.value=s,y()},error:function(s){showError(s)}})}function y(s=!0){s&&clearError();let o=`/proxy/${c.address}/${c.port}/pgconf/configuration`,n={};v.value==""&&p.value==""&&(v.value=_.value.categories[0]),p.value==""?o+=`/category/${O(v.value)}`:n={filter:p.value},$.ajax({url:o,type:"GET",data:n,async:!0,contentType:"application/json",dataType:"json",success:function(t){S.value=t,w()},error:function(t){showError(t)}})}function w(){$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration/status`,type:"GET",async:!0,contentType:"application/json",dataType:"json",success:function(s){g.value=s,[...E.value.querySelectorAll('[data-bs-toggle="popover"]')].map(n=>new U(n))},error:function(s){showError(s)}})}function D(){[...E.value.querySelectorAll('[data-bs-toggle="popover"]')].map(i=>new U(i)).forEach(i=>i.dispose());const n={settings:[]};clearError();let t=[];for(let i=0;i<T.value.length;i++){const B=T.value[i].elements;for(let L=0;L<B.length;L++){const h=B[L];if(h.name&&!t.includes(h.name)){t.push(h.name);let F=h.value;h.type==="checkbox"&&(F=h.checked?"on":"off"),n.settings.push({name:h.name,setting:F})}}}$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration`,type:"POST",data:JSON.stringify(n),async:!0,contentType:"application/json",dataType:"json",success:function(i){},error:function(i){showError(i)},complete:function(){y(!1),window.scrollTo(0,0)}})}function O(s){return encodeURIComponent(s).replace(/%20/g,"+")}function Y(s){let o=`Type: <b>${s.vartype}</b><br>`;return s.unit&&(o+=`Unit:<b>${s.unit}</b><br>`),["integer","real"].includes(s.vartype)&&(o+=`Minimum: <b>${s.min_val}</b><br>Maximum:<b>${s.max_val}</b>`),o}function q(s,o){clearError(),j.value.clear(),M.value=s,P.value=o,V.show()}function G(){C.value=!0;let s={settings:[{name:M.value,setting:P.value}]};$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration`,type:"POST",data:JSON.stringify(s),async:!0,contentType:"application/json",dataType:"json",success:function(o){y(),V.hide(),C.value=!1},error:function(o){C.value=!1,j.value.fromXHR(o)}})}function J(s){return s.replace(/^\{|\}$/g,"").split(",")}function z(s,o){return s===o||`'${s}'`===o}return(s,o)=>(l(),r(b,null,[e("div",ue,[e("div",pe,[e("div",me,[I(ne,{ref_key:"error",ref:j},null,512),a(),C.value?(l(),r(b,{key:0},[ve,a(),fe,a(),_e],64)):(l(),r(b,{key:1},[be,a(),e("div",he,[e("p",null,[e("b",null,f(M.value),1),a(" to "),e("b",null,f(P.value),1),a(` ?
            `)])]),a(),e("div",ye,[e("button",{type:"button",class:"btn btn-success",id:"resetYesButton",onClick:o[0]||(o[0]=n=>G())},"Yes"),a(),ge])],64))])])]),a(),g.value.restart_pending?(l(),r("div",ke,[e("div",$e,[e("div",Ce,[xe,a(),e("ul",null,[(l(!0),r(b,null,k(g.value.restart_changes,n=>(l(),r("li",null,[a(f(n.name)+" ",1),e("button",{type:"button",onClick:t=>q(n.name,n.boot_val),class:"btn-cancel btn btn-link btn-sm"},[Te,a(` Cancel change
            `)],8,Se)]))),256))])])])])):x("",!0),a(),e("div",je,[e("div",Ee,[Me,a(),e("div",Pe,[N(e("input",{class:"form-control",id:"inputSearchSettings",name:"filter",placeholder:"Find in settings","onUpdate:modelValue":o[1]||(o[1]=n=>p.value=n)},null,512),[[Q,p.value]]),a(),p.value?(l(),r("button",{key:0,class:"input-group-text",id:"buttonResetSearch",onClick:o[2]||(o[2]=n=>{p.value="",y()})},Le)):x("",!0),a(),e("button",{type:"submit",class:"input-group-text",id:"buttonSearchSettings",onClick:o[3]||(o[3]=n=>y())},qe)])]),a(),e("div",Be,[Fe,a(),e("div",Ie,[Ue,a(),N(e("select",{class:"form-select",id:"selectConfCat",disabled:p.value!="",onChange:o[4]||(o[4]=n=>y()),"onUpdate:modelValue":o[5]||(o[5]=n=>v.value=n)},[p.value?x("",!0):(l(!0),r(b,{key:0},k(_.value.categories,n=>(l(),r("option",{value:n,selected:n===v.value},f(n),9,we))),256))],40,Ae),[[W,v.value]])])])]),a(),e("div",{class:"row",ref_key:"contentEl",ref:E},[e("div",De,[(l(!0),r(b,null,k(S.value,n=>(l(),r("div",Oe,[e("div",Ye,f(n.category),1),a(),e("div",Ge,[e("form",{ref_for:!0,ref_key:"settings",ref:T,onSubmit:ee(D,["prevent"])},[e("table",Je,[e("tbody",null,[(l(!0),r(b,null,k(n.rows,t=>(l(),r("tr",null,[e("td",null,[e("span",ze,f(t.name),1),a(),e("p",He,f(t.desc),1)]),a(),e("td",Xe,[t.vartype=="bool"?(l(),r("div",Ze,[I(de,{name:t.name,id:"select"+t.name,setting:t.setting},null,8,["name","id","setting"])])):t.vartype==="enum"?(l(),r("select",{key:1,class:"form-control form-control-sm",name:t.name,id:"select"+t.name},[(l(!0),r(b,null,k(J(t.enumvals),i=>(l(),r("option",{key:i,value:i,selected:z(i,t.setting)},f(i),9,Qe))),128))],8,Ke)):(l(),r("input",{key:2,"data-bs-toggle":"popover","data-bs-trigger":"hover","data-bs-placement":"top","data-bs-html":"true","data-bs-content":Y(t),type:"text",class:"form-control form-control-sm",name:t.name,id:"input"+t.name,placeholder:t.name,value:t.setting!==null?t.setting_raw:""},null,8,We)),a(),t.setting!=t.boot_val?(l(),r("button",{key:3,type:"button",class:"btn btn-link",id:"buttonResetDefault_"+t.name,"data-bs-toggle":"popover","data-bs-trigger":"hover","data-bs-placement":"right",title:t.name,"data-bs-html":"true","data-bs-content":"Reset to: "+t.boot_val,onClick:i=>q(t.name,t.boot_val)},[et,a(`
                      Reset to default
                    `)],8,Re)):x("",!0)])]))),256))])]),a(),tt],544)])]))),256))])],512)],64))}},st=le(ot,[["__scopeId","data-v-5c302b6d"]]);se({components:{configuration:st}}).mount("#app");
