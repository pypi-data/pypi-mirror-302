import{f as H,e as I}from"./index.NkaAmagH.js";import"./singletons.YLCiVgCN.js";import{w as $,t as W}from"./scheduler.E6X4giYD.js";import{b as J,k as X}from"./ProgressBar.svelte_svelte_type_style_lang.TlH1isqv.js";import{p as L,s as Y}from"./stringify.ZBF_Z-nX.js";function G(e){return e.toString().split(/[[\].]+/).filter(t=>t)}function Q(e){return e.reduce((t,r)=>{const i=String(r);return typeof r=="number"||/^\d+$/.test(i)?t+=`[${i}]`:t?t+=`.${i}`:t+=i,t},"")}class w extends Error{constructor(t){super(t),Object.setPrototypeOf(this,w.prototype)}}function Z(e,t,r){return e[t]=r,"skip"}function z(e,t){return t.value!==void 0&&typeof t.value!="object"&&t.path.length<e.length}function Ze(e,t,r={}){r.modifier||(r.modifier=n=>z(t,n)?void 0:n.value);const i=N(e,t,r.modifier);if(i)return r.value===void 0||r.value(i.value)?i:void 0}function N(e,t,r){if(!t.length)return;const i=[t[0]];let n=e;for(;i.length<t.length;){const s=i[i.length-1],a=r?r({parent:n,key:String(s),value:n[s],path:i.map(f=>String(f)),isLeaf:!1,set:f=>Z(n,s,f)}):n[s];if(a===void 0)return;n=a,i.push(t[i.length])}const o=t[t.length-1];return{parent:n,key:String(o),value:n[o],path:t.map(s=>String(s)),isLeaf:!0,set:s=>Z(n,o,s)}}function T(e,t,r=[]){for(const i in e){const n=e[i],o=n===null||typeof n!="object",s={parent:e,key:i,value:n,path:r.map(String).concat([i]),isLeaf:o,set:f=>Z(e,i,f)},a=t(s);if(a==="abort")return a;if(a==="skip")continue;if(!o){const f=T(n,t,s.path);if(f==="abort")return f}}}async function Ne(e,t,r=[]){for(const i in e){const n=e[i],o=n===null||typeof n!="object",s={parent:e,key:i,value:n,path:r.map(String).concat([i]),isLeaf:o,set:f=>Z(e,i,f)},a=await t(s);if(a==="abort")return a;if(a==="skip")break;if(!o){const f=T(n,t,s.path);if(f==="abort")return f}}}function ee(e,t){return e===t||e.size===t.size&&[...e].every(r=>t.has(r))}function Oe(e,t){const r=new Map;function i(n,o){const s=N(o,n.path);function a(){r.set(n.path.join(" "),n.path)}n.isLeaf?s?n.value!==s.value&&a():a():s&&(n.value instanceof Date&&s.value instanceof Date&&n.value.getTime()!=s.value.getTime()||n.value instanceof Set&&s.value instanceof Set&&!ee(n.value,s.value))&&a()}return T(e,n=>i(n,t)),T(t,n=>i(n,e)),Array.from(r.values())}function te(e,t,r){for(const i of t){const n=N(e,i,({parent:o,key:s,value:a})=>((a===void 0||typeof a!="object")&&(o[s]={}),o[s]));n&&(n.parent[n.key]=r)}}function v(e){return"structuredClone"in globalThis?structuredClone(e):L(Y(e))}function S(e){const t=e;let r=!0,i=!1,n=!1,o=!1,s,a;for(;r;)switch(e._def.typeName){case"ZodNullable":i=!0,e=e.unwrap();break;case"ZodDefault":o=!0,a=e._def.defaultValue(),e=e._def.innerType;break;case"ZodOptional":n=!0,e=e.unwrap();break;case"ZodEffects":s||(s=e),e=e._def.schema;break;case"ZodPipeline":e=e._def.out;break;case"ZodBranded":e=e.unwrap();break;default:r=!1}return{zodType:e,originalType:t,isNullable:i,isOptional:n,hasDefault:o,defaultValue:a,effects:s}}function ne(e){let t=0;for(let r=0,i=e.length;r<i;r++){const n=e.charCodeAt(r);t=(t<<5)-t+n,t|=0}return t<0&&(t=t>>>0),t.toString(36)}function re(e){return ne(x(e))}function x(e){let t="";const r=S(e);switch(r.zodType._def.typeName){case"ZodObject":{for(const[i,n]of Object.entries(r.zodType.shape))t+="ZodObject:"+i+":"+x(n);break}case"ZodArray":{const i=r.zodType;t+="ZodArray:"+x(i.element);break}default:t+=r.zodType._def.typeName}return t}function ie(e,t){const r=se(e);if(r)return r;const i={typeInfo:V(e),defaultEntity:R(e),constraints:B(e,t),keys:Object.keys(e.keyof().Values),hash:re(e),errorShape:ae(e)};return oe(e,i),i}function oe(e,t){P.set(e,t)}function se(e){return P.get(e)}const P=new WeakMap;function V(e){return C(e,t=>S(t))}function F(e,t,r,i){if(e)return e;const{zodType:n,isNullable:o,isOptional:s,hasDefault:a,defaultValue:f}=i;if(t&&e!==void 0)return e;if(a)return f;if(o)return null;if(!s&&r){if(n._def.typeName=="ZodString")return"";if(n._def.typeName=="ZodNumber")return 0;if(n._def.typeName=="ZodBoolean")return!1;if(n._def.typeName=="ZodArray")return[];if(n._def.typeName=="ZodObject")return R(n);if(n._def.typeName=="ZodSet")return new Set;if(n._def.typeName=="ZodRecord")return{};if(n._def.typeName=="ZodBigInt")return BigInt(0);if(n._def.typeName=="ZodSymbol")return Symbol()}}function R(e){for(;e._def.typeName=="ZodEffects";)e=e._def.schema;if(e._def.typeName!="ZodObject")throw new w("Only Zod schema objects can be used with defaultValues. Define the schema with z.object({ ... }) and optionally refine/superRefine/transform at the end.");const t=e,r=Object.keys(t.keyof().Values),i=V(t);return Object.fromEntries(r.map(n=>{const o=i[n],s=F(void 0,!0,!0,o);return[n,s]}))}function B(e,t){function r(n,o,s){const a={};if(o._def.typeName=="ZodString"){const f=o,u=f._def.checks.filter(c=>c.kind=="regex");u.length>1&&t?.multipleRegexps!==!1&&console.warn(`Field "${n}" has more than one regexp, only the first one will be used in constraints. Set the warnings.multipleRegexps option to false to disable this warning.`);const l=u.length>0&&u[0].kind=="regex"?u[0].regex.source:void 0;l&&(a.pattern=l),f.minLength!==null&&(a.minlength=f.minLength),f.maxLength!==null&&(a.maxlength=f.maxLength)}else if(o._def.typeName=="ZodNumber"){const f=o,u=f._def.checks.filter(c=>c.kind=="multipleOf");u.length>1&&t?.multipleSteps!==!1&&console.warn(`Field "${n}" has more than one step, only the first one will be used in constraints. Set the warnings.multipleSteps option to false to disable this warning.`);const l=u.length>0&&u[0].kind=="multipleOf"?u[0].value:null;f.minValue!==null&&(a.min=f.minValue),f.maxValue!==null&&(a.max=f.maxValue),l!==null&&(a.step=l)}else if(o._def.typeName=="ZodDate"){const f=o;f.minDate&&(a.min=f.minDate.toISOString()),f.maxDate&&(a.max=f.maxDate.toISOString())}else o._def.typeName=="ZodArray"&&(o._def.minLength&&(a.min=o._def.minLength.value),o._def.maxLength&&(a.max=o._def.maxLength.value),o._def.exactLength&&(a.min=a.max=o._def.exactLength.value));return!s.isNullable&&!s.isOptional&&(a.required=!0),Object.keys(a).length>0?a:void 0}function i(n,o){const s=S(o);return o=s.zodType,o._def.typeName=="ZodArray"?i(n,o._def.type):o._def.typeName=="ZodObject"?B(o,t):r(n,o,s)}return C(e,(n,o)=>i(o,n),n=>!!n)}function C(e,t,r){const i=e.keyof().Values;return Object.fromEntries(Object.keys(i).map(n=>[n,t(e.shape[n],n)]).filter(n=>r?r(n[1]):!0))}const k=new WeakMap;function ae(e){return k.has(e)||k.set(e,E(e)),k.get(e)}function E(e){const t=S(e).zodType;if(t._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(t.shape).map(([r,i])=>[r,E(i)]).filter(r=>r[1]!==void 0));if(t._def.typeName=="ZodArray")return E(t._def.type)??{};if(t._def.typeName=="ZodRecord")return E(t._def.valueType)??{};if(t._def.typeName=="ZodUnion")return t._def.options.reduce((i,n)=>{const o=E(n);return o&&(i={...i??{},...o}),i},void 0)}function j(e,t,r=!0){const i={},n=Object.entries(e);if("_errors"in e&&e._errors.length){if(!t||!r)return e._errors;i._errors=e._errors}for(const[o,s]of n.filter(([a])=>a!=="_errors")){const a=/^\d+$/.test(o);i[o]=j(s,t?a?t:t[o]:void 0,!!t?.[o])}return i}function ve(e){return U(e,[])}function U(e,t){return Object.entries(e).filter(([,i])=>i!==void 0).flatMap(([i,n])=>{if(Array.isArray(n)&&n.length>0){const o=t.concat([i]);return{path:Q(o),messages:n}}else return U(e[i],t.concat([i]))})}function ke(e,t){e.update(r=>(T(r,i=>{if(!(i.path.length==1&&i.path[0]=="_errors"&&!t.clearFormLevelErrors)&&Array.isArray(i.value))return i.set(void 0)}),t.undefinePath&&te(r,[t.undefinePath],void 0),r))}const fe=(e,t=0)=>{const r=e.getBoundingClientRect();return r.top>=t&&r.left>=0&&r.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&r.right<=(window.innerWidth||document.documentElement.clientWidth)},ue=(e,t=1.125,r="smooth")=>{const o=e.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*t);window.scrollTo({left:0,top:o,behavior:r})};var y;(function(e){e[e.Idle=0]="Idle",e[e.Submitting=1]="Submitting",e[e.Delayed=2]="Delayed",e[e.Timeout=3]="Timeout"})(y||(y={}));const le=new Set;let D=!1;function xe(e,t,r){let i=y.Idle,n,o,s=!1;const a=le;function f(){u(),c(i!=y.Delayed?y.Submitting:y.Delayed),n=window.setTimeout(()=>{n&&i==y.Submitting&&c(y.Delayed)},r.delayMs),o=window.setTimeout(()=>{o&&i==y.Delayed&&c(y.Timeout)},r.timeoutMs),a.add(u)}function u(){clearTimeout(n),clearTimeout(o),n=o=0,a.delete(u),c(y.Idle)}function l(){a.forEach(m=>m()),a.clear()}function c(m){i=m,t.submitting.set(i>=y.Submitting),t.delayed.set(i>=y.Delayed),t.timeout.set(i>=y.Timeout)}const g=e;function d(m){const h=m.target;r.selectErrorText&&h.select()}function p(){r.selectErrorText&&g.querySelectorAll("input").forEach(m=>{m.addEventListener("invalid",d)})}function b(){r.selectErrorText&&g.querySelectorAll("input").forEach(m=>m.removeEventListener("invalid",d))}const K=e;function M(m){return typeof r.autoFocusOnError=="boolean"?r.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(m)}const A=async()=>{if(r.scrollToError=="off")return;const m=r.errorSelector;if(!m)return;await W();let h;if(h=K.querySelector(m),!h)return;h=h.querySelector(m)??h;const O=r.stickyNavbar?document.querySelector(r.stickyNavbar):null;if(typeof r.scrollToError!="string"?h.scrollIntoView(r.scrollToError):fe(h,O?.offsetHeight??0)||ue(h,void 0,r.scrollToError),!M(navigator.userAgent))return;let _;if(_=h,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(_.tagName)||(_=_.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),_)try{_.focus({preventScroll:!0}),r.selectErrorText&&_.tagName=="INPUT"&&_.select()}catch{}};{p();const m=(h,O=!1)=>{u(),h||setTimeout(A),O&&!s&&l()};return $(()=>{b(),m(!0)}),D||(J(()=>{s=!0}),X(h=>{h.type!="enter"&&(s=!1,l())}),D=!0),{submitting:()=>{s=!1,f()},completed:m,scrollToFirstError:()=>{setTimeout(A)},isSubmitting:()=>i===y.Submitting||i===y.Delayed}}}function ce(e,t,r,i){(r==null||typeof r!="string"&&!Array.isArray(r))&&(i=r,r=t,t=""),i===void 0&&(i={});const n=Array.isArray(r)?r:[r];if(e.errors||(e.errors={}),t===null||t==="")e.errors._errors||(e.errors._errors=[]),e.errors._errors=i.overwrite?n:e.errors._errors.concat(n);else{const o=G(t),s=N(e.errors,o,({parent:a,key:f,value:u})=>(u===void 0&&(a[f]={}),a[f]));s&&(s.parent[s.key]=Array.isArray(s.value)&&!i.overwrite?s.value.concat(n):n)}return e.valid=!1,H(i.status??400,{form:e})}function de(e,t,r){const i={},{schemaKeys:n,entityInfo:o}=t;function s(f,u,l){if(r&&r.includes(f))return u;if(!(u&&typeof u!="string"))return a(f,u,l)}for(const f of n){const u=o.typeInfo[f],l=e.getAll(f);if(u.zodType._def.typeName!="ZodArray")i[f]=s(f,l[0],u);else{const c=S(u.zodType._def.type);i[f]=l.map(g=>s(f,g,c))}}function a(f,u,l){const c=F(u,!1,!0,l),g=l.zodType,d=g._def.typeName;if(!u&&d!="ZodBoolean")return c;if(d=="ZodString")return u;if(d=="ZodNumber")return g.isInt?parseInt(u??"",10):parseFloat(u??"");if(d=="ZodBoolean")return(!!(u!="false"&&u)).valueOf();if(d=="ZodDate")return new Date(u??"");if(d=="ZodArray"){const p=S(g._def.type);return a(f,u,p)}else if(d=="ZodBigInt")try{return BigInt(u??".")}catch{return NaN}else if(d=="ZodLiteral"){const p=typeof g.value;if(p==="string")return u;if(p==="number")return parseFloat(u??"");if(p==="boolean")return(!!u).valueOf();throw new w("Unsupported ZodLiteral type: "+p)}else{if(d=="ZodUnion"||d=="ZodEnum"||d=="ZodAny")return u;if(d=="ZodNativeEnum"){const p=g;if(u!==null&&u in p.enum){const b=p.enum[u];if(typeof b=="number")return b;if(b in p.enum)return p.enum[b]}else if(u!==null&&Object.values(p.enum).includes(u))return u;return}else if(d=="ZodSymbol")return Symbol(String(u))}throw d=="ZodObject"?new w(`Object found in form field "${f}". Set the dataType option to "json" and add use:enhance on the client to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`):new w("Unsupported Zod default type: "+g.constructor.name)}return i}function me(e,t){return e.data?e.data:t.hasEffects||t.opts.errors===!0?t.entityInfo.defaultEntity:void 0}function q(e,t,r){function i(){if(e.has("__superform_json"))try{const s=L(e.getAll("__superform_json").join("")??"");if(typeof s=="object")return s}catch{}return null}const n=i(),o=e.get("__superform_id")?.toString()??void 0;return n?{id:o,data:n,posted:!0}:{id:o,data:de(e,t,r?.preprocessed),posted:!0}}function pe(e,t,r){e instanceof URL&&(e=e.searchParams);const i=new FormData;for(const[o,s]of e.entries())i.append(o,s);const n=q(i,t,r);return n.posted=!1,n}function ye(e,t,r){const{opts:i,entityInfo:n}=t,o=e.posted,s=e.data?i.id??e.id??n.hash:i.id??n.hash;if(e.data){const{opts:a,schemaKeys:f,entityInfo:u,unwrappedSchema:l}=t;if(!r)throw new w("Validation data exists without validation result.");if(r.success)return{id:s,valid:!0,posted:o,errors:{},data:r.data,constraints:u.constraints};{const c=e.data,g=a.errors!==!1?j(r.error.format(),u.errorShape):{},p=l._def.unknownKeys=="passthrough"?{...v(u.defaultEntity),...c}:Object.fromEntries(f.map(b=>[b,b in c?c[b]:v(u.defaultEntity[b])]));return{id:s,valid:!1,posted:o,errors:g,data:p,constraints:u.constraints}}}else{let a,f={};const u=r?.success??!1,{opts:l,entityInfo:c}=t;return r&&(r.success?a=r.data:l.errors===!0&&(f=j(r.error.format(),c.errorShape))),{id:s,valid:u,posted:o,errors:f,data:a??v(c.defaultEntity),constraints:c.constraints}}}function he(e,t){const r=e;let i=e,n=!1;for(;i._def.typeName=="ZodEffects";)n=!0,i=i._def.schema;if(i._def.typeName!="ZodObject")throw new w("Only Zod schema objects can be used with superValidate. Define the schema with z.object({ ... }) and optionally refine/superRefine/transform at the end.");const o=ie(i,t?.warnings);return{originalSchema:r,unwrappedSchema:i,hasEffects:n,entityInfo:o,schemaKeys:o.keys,opts:t??{}}}function je(e,t,r){e&&typeof e=="object"&&"safeParse"in e&&(r=t,t=e,e=null);const i=he(t,r),n=e instanceof FormData?q(e,i,r):e instanceof URL||e instanceof URLSearchParams?pe(e,i):{id:void 0,data:e,posted:!1},o=me(n,i),s=o?i.originalSchema.safeParse(o):void 0;return ye(n,i,s)}async function Ae(e,t){const r=await e("/api/testruns/"+t).then(n=>(n.ok||I(n.status,n.statusText),n.json())),i=await e("/api/testruns/measurements/"+r.id).then(n=>(n.ok||I(n.status,n.statusText),n.json()));return{run:r,measurements:i}}async function Ie(e,t,r){let i="POST";return t.data.id&&(e+="/"+t.data.id,i="PUT"),await ge(i,e,t,r)}async function ge(e,t,r,i){let n="/api/"+t;const o=await fetch(n,{headers:{"Content-Type":"application/json"},method:e,body:JSON.stringify(i||r.data)}),s=await o.json();if(console.log(o),!o.ok)if(o.status==422)"error"in s&&"type"in s.error&&(s.error.type=="unique_violation"?ce(r,s.error.field,"An entry with this value already exists"):console.log("TODO: implement this error type"));else throw new Error("TODO");return s}export{xe as F,w as S,Ne as a,T as b,te as c,v as d,ae as e,ke as f,Q as g,ve as h,z as i,Oe as j,je as k,Ie as l,j as m,ge as n,Ae as o,Ze as p,G as s,N as t};
