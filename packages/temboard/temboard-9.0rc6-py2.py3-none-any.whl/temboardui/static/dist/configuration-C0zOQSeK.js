import{p as u,c as z,q as H,o as l,e as r,z as e,g as f,f as a,P as N,Z as X,s as Z,k as I,F as _,A as k,h as x,U as Q,ab as W,Y as R,S as ee,V as te,$ as oe,a0 as se,N as ae}from"./vue-DqMao7g8.js";import{M as ne,P as U}from"./bootstrap.esm-BOBBXxos.js";import{$}from"./jquery-BALIvAru.js";import{_ as le}from"./Error-CN0ET5RL.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./highlight.js-CWp04Ajj.js";const ie={class:"form-check form-switch"},ce=["for"],de=["id","name"],ue={__name:"SettingSwitch",props:["id","name","setting"],setup(m){const c=m,b=u(c.setting=="on"),g=z(()=>b.value?"on":"off");return H(c,()=>b.value=c.setting=="on"),(S,v)=>(l(),r("div",ie,[e("label",{for:m.id},f(g.value),9,ce),a(),N(e("input",{class:"form-check-input",type:"checkbox",role:"switch",id:m.id,name:m.name,"onUpdate:modelValue":v[0]||(v[0]=p=>b.value=p)},null,8,de),[[X,b.value]])]))}},d=m=>(oe("data-v-965ebcbd"),m=m(),se(),m),pe={class:"modal fade",id:"resetModal",tabindex:"-1",role:"dialog","aria-labelledby":"resetModalLabel"},me={class:"modal-dialog",role:"document"},ve={class:"modal-content"},fe=d(()=>e("div",{class:"modal-header"},[e("h4",{class:"modal-title"},"Processing, please wait...")],-1)),be=ee('<div class="modal-body" data-v-965ebcbd><div class="row" data-v-965ebcbd><div class="col-4 offset-4" data-v-965ebcbd><div class="progress" data-v-965ebcbd><div class="progress-bar progress-bar-striped" style="width:100%;" data-v-965ebcbd>Please wait ...</div></div></div></div></div>',1),_e=d(()=>e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Close")],-1)),he=d(()=>e("div",{class:"modal-header"},[e("h4",{class:"modal-title",id:"resetModalLabel"},"Reset parameter:"),a(),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),ye={class:"modal-body",id:"resetModalBody"},ge={class:"modal-footer",id:"resetModalFooter"},ke=d(()=>e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),$e={key:0,class:"row"},Ce={class:"col-12"},xe={id:"alert-configuration",class:"alert alert-warning alert-dismissible",role:"alert"},Se=d(()=>e("p",null,"The options below will be applied after restart :",-1)),Te=["onClick"],je=d(()=>e("span",{class:"fa fa-times","aria-hidden":"true"},null,-1)),Ee={class:"row mb-3"},Me={class:"col-3 me-auto"},Pe=d(()=>e("label",{class:"sr-only",for:"selectServer"},"Search",-1)),Ve={class:"input-group"},Le=d(()=>e("i",{class:"fa fa-fw fa-times"},null,-1)),Ne=[Le],qe=d(()=>e("i",{class:"fa fa-fw fa-search"},null,-1)),Be=[qe],Fe={class:"col-7"},Ie=d(()=>e("label",{class:"sr-only",for:"selectConfCat"},"Category",-1)),Ue={class:"input-group"},we=d(()=>e("div",{class:"input-group-text"},"Category",-1)),Ae=["disabled"],De=["value","selected"],Oe={class:"col-12"},Ye={class:"card"},Ge={class:"card-header"},Je={class:"card-body"},Ke={class:"table table-sm"},ze={class:"title-setting"},He={class:"text-body-secondary mb-0 small"},Xe={class:"input-setting"},Ze={key:0},Qe=["name","id"],We=["value","selected"],Re=["data-bs-content","name","id","placeholder","value"],et=["id","title","data-bs-content","onClick"],tt=d(()=>e("span",{class:"fa fa-undo","aria-hidden":"true"},null,-1)),ot=d(()=>e("div",{class:"row"},[e("div",{class:"col-12 text-center"},[e("button",{type:"submit",class:"btn btn-sm btn-success"},"Save and reload configuration")])],-1)),st={__name:"Configuration",props:["address","port"],setup(m){const c=m,b=u([]),g=u([]),S=u([]),v=u(""),p=u(""),T=u(null),C=u(!1),j=u(null),E=u(null),M=u(""),P=u("");let V;Z(()=>{w(),V=new ne(document.getElementById("resetModal"))});function w(){$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration/categories`,type:"GET",async:!0,contentType:"application/json",dataType:"json",success:function(s){b.value=s,h()},error:function(s){showError(s)}})}function h(s=!0){s&&clearError();let t=`/proxy/${c.address}/${c.port}/pgconf/configuration`,n={};v.value==""&&p.value==""&&(v.value=b.value.categories[0]),p.value==""?t+=`/category/${O(v.value)}`:n={filter:p.value},$.ajax({url:t,type:"GET",data:n,async:!0,contentType:"application/json",dataType:"json",success:function(o){S.value=o,A()},error:function(o){showError(o)}})}function A(){$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration/status`,type:"GET",async:!0,contentType:"application/json",dataType:"json",success:function(s){g.value=s,[...E.value.querySelectorAll('[data-bs-toggle="popover"]')].map(n=>new U(n))},error:function(s){showError(s)}})}function D(){[...E.value.querySelectorAll('[data-bs-toggle="popover"]')].map(i=>new U(i)).forEach(i=>i.dispose());const n={settings:[]};clearError();let o=[];for(let i=0;i<T.value.length;i++){const B=T.value[i].elements;for(let L=0;L<B.length;L++){const y=B[L];if(y.name&&!o.includes(y.name)){o.push(y.name);let F=y.value;y.type==="checkbox"&&(F=y.checked?"on":"off"),n.settings.push({name:y.name,setting:F})}}}$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration`,type:"POST",data:JSON.stringify(n),async:!0,contentType:"application/json",dataType:"json",success:function(i){},error:function(i){showError(i)},complete:function(){h(!1),window.scrollTo(0,0)}})}function O(s){return encodeURIComponent(s).replace(/%20/g,"+")}function Y(s){let t=`Type: <b>${s.vartype}</b><br>`;return s.unit&&(t+=`Unit:<b>${s.unit}</b><br>`),["integer","real"].includes(s.vartype)&&(t+=`Minimum: <b>${s.min_val}</b><br>Maximum:<b>${s.max_val}</b>`),t}function q(s,t){clearError(),j.value.clear(),M.value=s,P.value=t,V.show()}function G(){C.value=!0;let s={settings:[{name:M.value,setting:P.value}]};$.ajax({url:`/proxy/${c.address}/${c.port}/pgconf/configuration`,type:"POST",data:JSON.stringify(s),async:!0,contentType:"application/json",dataType:"json",success:function(t){h(),V.hide(),C.value=!1},error:function(t){C.value=!1,j.value.fromXHR(t)}})}function J(s){return s.replace(/^\{|\}$/g,"").split(",")}function K(s,t){return s===t||`'${s}'`===t}return(s,t)=>(l(),r(_,null,[e("div",pe,[e("div",me,[e("div",ve,[I(le,{ref_key:"error",ref:j},null,512),a(),C.value?(l(),r(_,{key:0},[fe,a(),be,a(),_e],64)):(l(),r(_,{key:1},[he,a(),e("div",ye,[e("p",null,[e("b",null,f(M.value),1),a(" to "),e("b",null,f(P.value),1),a(` ?
            `)])]),a(),e("div",ge,[e("button",{type:"button",class:"btn btn-success",id:"resetYesButton",onClick:t[0]||(t[0]=n=>G())},"Yes"),a(),ke])],64))])])]),a(),g.value.restart_pending?(l(),r("div",$e,[e("div",Ce,[e("div",xe,[Se,a(),e("ul",null,[(l(!0),r(_,null,k(g.value.restart_changes,n=>(l(),r("li",null,[a(f(n.name)+" ",1),e("button",{type:"button",onClick:o=>q(n.name,n.boot_val),class:"btn-cancel btn btn-link btn-sm"},[je,a(` Cancel change
            `)],8,Te)]))),256))])])])])):x("",!0),a(),e("div",Ee,[e("div",Me,[Pe,a(),e("div",Ve,[N(e("input",{class:"form-control",id:"inputSearchSettings",name:"filter",placeholder:"Find in settings","onUpdate:modelValue":t[1]||(t[1]=n=>p.value=n),onKeyup:t[2]||(t[2]=W(n=>h(),["enter"]))},null,544),[[Q,p.value]]),a(),p.value?(l(),r("button",{key:0,class:"input-group-text",id:"buttonResetSearch",onClick:t[3]||(t[3]=n=>{p.value="",h()})},Ne)):x("",!0),a(),e("button",{type:"submit",class:"input-group-text",id:"buttonSearchSettings",onClick:t[4]||(t[4]=n=>h())},Be)])]),a(),e("div",Fe,[Ie,a(),e("div",Ue,[we,a(),N(e("select",{class:"form-select",id:"selectConfCat",disabled:p.value!="",onChange:t[5]||(t[5]=n=>h()),"onUpdate:modelValue":t[6]||(t[6]=n=>v.value=n)},[p.value?x("",!0):(l(!0),r(_,{key:0},k(b.value.categories,n=>(l(),r("option",{value:n,selected:n===v.value},f(n),9,De))),256))],40,Ae),[[R,v.value]])])])]),a(),e("div",{class:"row",ref_key:"contentEl",ref:E},[e("div",Oe,[(l(!0),r(_,null,k(S.value,n=>(l(),r("div",Ye,[e("div",Ge,f(n.category),1),a(),e("div",Je,[e("form",{ref_for:!0,ref_key:"settings",ref:T,onSubmit:te(D,["prevent"])},[e("table",Ke,[e("tbody",null,[(l(!0),r(_,null,k(n.rows,o=>(l(),r("tr",null,[e("td",null,[e("span",ze,f(o.name),1),a(),e("p",He,f(o.desc),1)]),a(),e("td",Xe,[o.vartype=="bool"?(l(),r("div",Ze,[I(ue,{name:o.name,id:"select"+o.name,setting:o.setting},null,8,["name","id","setting"])])):o.vartype==="enum"?(l(),r("select",{key:1,class:"form-control form-control-sm",name:o.name,id:"select"+o.name},[(l(!0),r(_,null,k(J(o.enumvals),i=>(l(),r("option",{key:i,value:i,selected:K(i,o.setting)},f(i),9,We))),128))],8,Qe)):(l(),r("input",{key:2,"data-bs-toggle":"popover","data-bs-trigger":"hover","data-bs-placement":"top","data-bs-html":"true","data-bs-content":Y(o),type:"text",class:"form-control form-control-sm",name:o.name,id:"input"+o.name,placeholder:o.name,value:o.setting!==null?o.setting_raw:""},null,8,Re)),a(),o.setting!=o.boot_val?(l(),r("button",{key:3,type:"button",class:"btn btn-link",id:"buttonResetDefault_"+o.name,"data-bs-toggle":"popover","data-bs-trigger":"hover","data-bs-placement":"right",title:o.name,"data-bs-html":"true","data-bs-content":"Reset to: "+o.boot_val,onClick:i=>q(o.name,o.boot_val)},[tt,a(`
                      Reset to default
                    `)],8,et)):x("",!0)])]))),256))])]),a(),ot],544)])]))),256))])],512)],64))}},at=re(st,[["__scopeId","data-v-965ebcbd"]]);ae({components:{configuration:at}}).mount("#app");
