import{r as g,j as l,P as oe,a as ae,B as le,C as ie,b as ue,c as ce,d as fe,e as de,f as me,g as ve,h as he,i as pe,k as O,l as xe,u as ge,m as ye,n as Y,o as Ce,p as we,q as be,s as W,L as I,t as je,T as Ne}from"./index-Nxt-e6QL.js";function R({items:n,value:e,setValue:r}){var s;const[t,o]=g.useState(!1);return l.jsxs(oe,{open:t,onOpenChange:o,children:[l.jsx(ae,{asChild:!0,children:l.jsxs(le,{variant:"outline",role:"combobox","aria-expanded":t,className:"w-[200px] justify-between",children:[e?(s=n.find(a=>a.value===e))==null?void 0:s.label:"Select item...",l.jsx(ie,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),l.jsx(ue,{className:"w-[200px] p-0",children:l.jsxs(ce,{children:[l.jsx(fe,{placeholder:"Search item...",className:"h-9"}),l.jsxs(de,{children:[l.jsx(me,{children:"No item found."}),l.jsx(ve,{children:n.map(a=>l.jsxs(he,{value:a.value,onSelect:i=>{r(i===e?"":i),o(!1)},children:[a.label,l.jsx(pe,{className:O("ml-auto h-4 w-4",e===a.value?"opacity-100":"opacity-0")})]},a.value))})]})]})})]})}var _="Switch",[Ee,_e]=xe(_),[Te,ke]=Ee(_),K=g.forwardRef((n,e)=>{const{__scopeSwitch:r,name:t,checked:o,defaultChecked:s,required:a,disabled:i,value:u="on",onCheckedChange:d,form:c,...f}=n,[m,h]=g.useState(null),p=ge(e,w=>h(w)),x=g.useRef(!1),b=m?c||!!m.closest("form"):!0,[y=!1,N]=ye({prop:o,defaultProp:s,onChange:d});return l.jsxs(Te,{scope:r,checked:y,disabled:i,children:[l.jsx(Y.button,{type:"button",role:"switch","aria-checked":y,"aria-required":a,"data-state":re(y),"data-disabled":i?"":void 0,disabled:i,value:u,...f,ref:p,onClick:Ce(n.onClick,w=>{N(v=>!v),b&&(x.current=w.isPropagationStopped(),x.current||w.stopPropagation())})}),b&&l.jsx(Le,{control:m,bubbles:!x.current,name:t,value:u,checked:y,required:a,disabled:i,form:c,style:{transform:"translateX(-100%)"}})]})});K.displayName=_;var ee="SwitchThumb",ne=g.forwardRef((n,e)=>{const{__scopeSwitch:r,...t}=n,o=ke(ee,r);return l.jsx(Y.span,{"data-state":re(o.checked),"data-disabled":o.disabled?"":void 0,...t,ref:e})});ne.displayName=ee;var Le=n=>{const{control:e,checked:r,bubbles:t=!0,...o}=n,s=g.useRef(null),a=we(r),i=be(e);return g.useEffect(()=>{const u=s.current,d=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(d,"checked").set;if(a!==r&&f){const m=new Event("click",{bubbles:t});f.call(u,r),u.dispatchEvent(m)}},[a,r,t]),l.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:s,style:{...n.style,...i,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function re(n){return n?"checked":"unchecked"}var te=K,$e=ne;const se=g.forwardRef(({className:n,...e},r)=>l.jsx(te,{className:O("peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",n),...e,ref:r,children:l.jsx($e,{className:O("pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0")})}));se.displayName=te.displayName;function C(){}C.prototype={diff:function(e,r){var t,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=o.callback;typeof o=="function"&&(s=o,o={});var a=this;function i(v){return v=a.postProcess(v,o),s?(setTimeout(function(){s(v)},0),!0):v}e=this.castInput(e,o),r=this.castInput(r,o),e=this.removeEmpty(this.tokenize(e,o)),r=this.removeEmpty(this.tokenize(r,o));var u=r.length,d=e.length,c=1,f=u+d;o.maxEditLength!=null&&(f=Math.min(f,o.maxEditLength));var m=(t=o.timeout)!==null&&t!==void 0?t:1/0,h=Date.now()+m,p=[{oldPos:-1,lastComponent:void 0}],x=this.extractCommon(p[0],r,e,0,o);if(p[0].oldPos+1>=d&&x+1>=u)return i(U(a,p[0].lastComponent,r,e,a.useLongestToken));var b=-1/0,y=1/0;function N(){for(var v=Math.max(b,-c);v<=Math.min(y,c);v+=2){var j=void 0,T=p[v-1],k=p[v+1];T&&(p[v-1]=void 0);var A=!1;if(k){var J=k.oldPos-v;A=k&&0<=J&&J<u}var H=T&&T.oldPos+1<d;if(!A&&!H){p[v]=void 0;continue}if(!H||A&&T.oldPos<k.oldPos?j=a.addToPath(k,!0,!1,0,o):j=a.addToPath(T,!1,!0,1,o),x=a.extractCommon(j,r,e,v,o),j.oldPos+1>=d&&x+1>=u)return i(U(a,j.lastComponent,r,e,a.useLongestToken));p[v]=j,j.oldPos+1>=d&&(y=Math.min(y,v-1)),x+1>=u&&(b=Math.max(b,v+1))}c++}if(s)(function v(){setTimeout(function(){if(c>f||Date.now()>h)return s();N()||v()},0)})();else for(;c<=f&&Date.now()<=h;){var w=N();if(w)return w}},addToPath:function(e,r,t,o,s){var a=e.lastComponent;return a&&!s.oneChangePerToken&&a.added===r&&a.removed===t?{oldPos:e.oldPos+o,lastComponent:{count:a.count+1,added:r,removed:t,previousComponent:a.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:r,removed:t,previousComponent:a}}},extractCommon:function(e,r,t,o,s){for(var a=r.length,i=t.length,u=e.oldPos,d=u-o,c=0;d+1<a&&u+1<i&&this.equals(t[u+1],r[d+1],s);)d++,u++,c++,s.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!s.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=u,d},equals:function(e,r,t){return t.comparator?t.comparator(e,r):e===r||t.ignoreCase&&e.toLowerCase()===r.toLowerCase()},removeEmpty:function(e){for(var r=[],t=0;t<e.length;t++)e[t]&&r.push(e[t]);return r},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function U(n,e,r,t,o){for(var s=[],a;e;)s.push(e),a=e.previousComponent,delete e.previousComponent,e=a;s.reverse();for(var i=0,u=s.length,d=0,c=0;i<u;i++){var f=s[i];if(f.removed)f.value=n.join(t.slice(c,c+f.count)),c+=f.count;else{if(!f.added&&o){var m=r.slice(d,d+f.count);m=m.map(function(h,p){var x=t[c+p];return x.length>h.length?x:h}),f.value=n.join(m)}else f.value=n.join(r.slice(d,d+f.count));d+=f.count,f.added||(c+=f.count)}}return s}function G(n,e){var r;for(r=0;r<n.length&&r<e.length;r++)if(n[r]!=e[r])return n.slice(0,r);return n.slice(0,r)}function Q(n,e){var r;if(!n||!e||n[n.length-1]!=e[e.length-1])return"";for(r=0;r<n.length&&r<e.length;r++)if(n[n.length-(r+1)]!=e[e.length-(r+1)])return n.slice(-r);return n.slice(-r)}function V(n,e,r){if(n.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(n)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return r+n.slice(e.length)}function q(n,e,r){if(!e)return n+r;if(n.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(n)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return n.slice(0,-e.length)+r}function L(n,e){return V(n,e,"")}function D(n,e){return q(n,e,"")}function X(n,e){return e.slice(0,De(n,e))}function De(n,e){var r=0;n.length>e.length&&(r=n.length-e.length);var t=e.length;n.length<e.length&&(t=n.length);var o=Array(t),s=0;o[0]=0;for(var a=1;a<t;a++){for(e[a]==e[s]?o[a]=o[s]:o[a]=s;s>0&&e[a]!=e[s];)s=o[s];e[a]==e[s]&&s++}s=0;for(var i=r;i<n.length;i++){for(;s>0&&n[i]!=e[s];)s=o[s];n[i]==e[s]&&s++}return s}var S="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",Se=new RegExp("[".concat(S,"]+|\\s+|[^").concat(S,"]"),"ug"),z=new C;z.equals=function(n,e,r){return r.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n.trim()===e.trim()};z.tokenize=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');r=Array.from(e.intlSegmenter.segment(n),function(s){return s.segment})}else r=n.match(Se)||[];var t=[],o=null;return r.forEach(function(s){/\s/.test(s)?o==null?t.push(s):t.push(t.pop()+s):/\s/.test(o)?t[t.length-1]==o?t.push(t.pop()+s):t.push(o+s):t.push(s),o=s}),t};z.join=function(n){return n.map(function(e,r){return r==0?e:e.replace(/^\s+/,"")}).join("")};z.postProcess=function(n,e){if(!n||e.oneChangePerToken)return n;var r=null,t=null,o=null;return n.forEach(function(s){s.added?t=s:s.removed?o=s:((t||o)&&Z(r,o,t,s),r=s,t=null,o=null)}),(t||o)&&Z(r,o,t,null),n};function Z(n,e,r,t){if(e&&r){var o=e.value.match(/^\s*/)[0],s=e.value.match(/\s*$/)[0],a=r.value.match(/^\s*/)[0],i=r.value.match(/\s*$/)[0];if(n){var u=G(o,a);n.value=q(n.value,a,u),e.value=L(e.value,u),r.value=L(r.value,u)}if(t){var d=Q(s,i);t.value=V(t.value,i,d),e.value=D(e.value,d),r.value=D(r.value,d)}}else if(r)n&&(r.value=r.value.replace(/^\s*/,"")),t&&(t.value=t.value.replace(/^\s*/,""));else if(n&&t){var c=t.value.match(/^\s*/)[0],f=e.value.match(/^\s*/)[0],m=e.value.match(/\s*$/)[0],h=G(c,f);e.value=L(e.value,h);var p=Q(L(c,h),m);e.value=D(e.value,p),t.value=V(t.value,c,p),n.value=q(n.value,c,c.slice(0,c.length-p.length))}else if(t){var x=t.value.match(/^\s*/)[0],b=e.value.match(/\s*$/)[0],y=X(b,x);e.value=D(e.value,y)}else if(n){var N=n.value.match(/\s*$/)[0],w=e.value.match(/^\s*/)[0],v=X(N,w);e.value=L(e.value,v)}}var Pe=new C;Pe.tokenize=function(n){var e=new RegExp("(\\r?\\n)|[".concat(S,"]+|[^\\S\\n\\r]+|[^").concat(S,"]"),"ug");return n.match(e)||[]};var B=new C;B.tokenize=function(n,e){e.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));var r=[],t=n.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var o=0;o<t.length;o++){var s=t[o];o%2&&!e.newlineIsToken?r[r.length-1]+=s:r.push(s)}return r};B.equals=function(n,e,r){return r.ignoreWhitespace?((!r.newlineIsToken||!n.includes(`
`))&&(n=n.trim()),(!r.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):r.ignoreNewlineAtEof&&!r.newlineIsToken&&(n.endsWith(`
`)&&(n=n.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),C.prototype.equals.call(this,n,e,r)};var ze=new C;ze.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var Ae=new C;Ae.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function F(n){"@babel/helpers - typeof";return F=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(n)}var $=new C;$.useLongestToken=!0;$.tokenize=B.tokenize;$.castInput=function(n,e){var r=e.undefinedReplacement,t=e.stringifyReplacer,o=t===void 0?function(s,a){return typeof a>"u"?r:a}:t;return typeof n=="string"?n:JSON.stringify(M(n,null,null,o),o,"  ")};$.equals=function(n,e,r){return C.prototype.equals.call($,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),r)};function M(n,e,r,t,o){e=e||[],r=r||[],t&&(n=t(o,n));var s;for(s=0;s<e.length;s+=1)if(e[s]===n)return r[s];var a;if(Object.prototype.toString.call(n)==="[object Array]"){for(e.push(n),a=new Array(n.length),r.push(a),s=0;s<n.length;s+=1)a[s]=M(n[s],e,r,t,o);return e.pop(),r.pop(),a}if(n&&n.toJSON&&(n=n.toJSON()),F(n)==="object"&&n!==null){e.push(n),a={},r.push(a);var i=[],u;for(u in n)Object.prototype.hasOwnProperty.call(n,u)&&i.push(u);for(i.sort(),s=0;s<i.length;s+=1)u=i[s],a[u]=M(n[u],e,r,t,u);e.pop(),r.pop()}else a=n;return a}var P=new C;P.tokenize=function(n){return n.slice()};P.join=P.removeEmpty=function(n){return n};function Ie(n,e,r){return P.diff(n,e,r)}const E=Symbol("placeholder"),Oe=n=>{const e=[];let r=0;for(;r<n.length;){const t=n[r];if(t.removed&&r+1<n.length&&n[r+1].added){const o=t.value,s=n[r+1].value,a=Math.max(o.length,s.length);e.push({type:"modified",oldValue:o.concat(Array(a-o.length).fill(E)),newValue:s.concat(Array(a-s.length).fill(E))}),r+=2}else if(t.removed){const o=t.value,s=Array(o.length).fill(E);e.push({type:"removed",oldValue:o,newValue:s}),r++}else if(t.added){const o=t.value,s=Array(o.length).fill(E);e.push({type:"added",oldValue:s,newValue:o}),r++}else e.push({type:"unchanged",oldValue:t.value,newValue:t.value}),r++}return e},Re=({diffedLines:n})=>{const e=Oe(n),r=t=>{const o=[];let s=0;const a=[];return e.forEach((i,u)=>{(t==="before"?i.oldValue:i.newValue).forEach((c,f)=>{c!==E?(s++,a.push(l.jsx("div",{className:"text-xs leading-5 text-gray-500 py-[1px]",children:s},`${t}-linenumber-${s}`))):a.push(l.jsx("div",{className:"text-xs leading-5 text-gray-500 py-[1px]",children:" "},`${t}-linenumber-placeholder-${u}-${f}`));const m=c===E?"bg-gray-200":i.type==="modified"?t==="before"?"bg-red-100":"bg-green-100":i.type==="added"&&t==="after"?"bg-green-100":i.type==="removed"&&t==="before"?"bg-red-100":"";o.push(l.jsx("div",{className:`${m} leading-5 px-4 py-[1px] min-h-[22px]`,children:c===null?"":c},`${t}-${u}-${f}`))})}),l.jsx("div",{className:"flex-1 overflow-x-auto",children:l.jsx("code",{className:"!p-0 !bg-transparent",children:l.jsxs("div",{className:"flex",children:[l.jsx("div",{className:"flex-none w-12 text-right pr-2 bg-gray-100 border-r border-gray-300",children:a}),l.jsx("pre",{className:"flex-grow !bg-transparent",children:o})]})})})};return l.jsx("div",{className:"font-mono text-sm border rounded-md overflow-hidden",children:l.jsxs("div",{className:"flex",children:[r("before"),l.jsx("div",{className:"w-px bg-gray-300"}),r("after")]})})},Ve=({diffedLines:n})=>{let e=0,r=0;return l.jsx("div",{className:"font-mono text-sm border rounded-md overflow-hidden",children:l.jsx("code",{className:"!p-0 !bg-transparent",children:l.jsxs("div",{className:"flex",children:[l.jsxs("div",{className:"flex gap-1 w-12 pl-1 bg-gray-100 border-r border-gray-300",children:[l.jsx("div",{children:n.map((t,o)=>!t.added&&!t.removed||t.removed?t.value.map(()=>(e++,l.jsx("div",{className:"py-0.5 text-gray-500",children:e},`before-${e}`))):t.value.map((s,a)=>l.jsx("div",{className:"py-0.5",children:" "},`after-empty-${r+a+1}`)))}),l.jsx("div",{children:n.map((t,o)=>!t.added&&!t.removed||t.added?t.value.map(()=>(r++,l.jsx("div",{className:"py-0.5 text-gray-500",children:r},`after-${r}`))):t.value.map((s,a)=>l.jsx("div",{className:"py-0.5",children:" "},`after-empty-${r+a+1}`)))})]}),l.jsx("pre",{className:"flex-grow !bg-transparent overflow-x-auto",children:n.map((t,o)=>{const s=t.added?"bg-green-100":t.removed?"bg-red-100":void 0,a=t.added?"+":t.removed?"-":" ";return t.value.map((i,u)=>l.jsxs("div",{className:`py-0.5 ${s}`,children:[a," ",i]},u))})})]})})})},qe=({value:n})=>{const[e,r]=g.useState("split"),[t,o]=g.useState(""),[s,a]=g.useState(""),{isPending:i,error:u,data:d}=W({queryKey:["fnParams"],queryFn:async()=>await(await fetch("/llm-fns/names")).json()});if(i)return l.jsx("div",{children:"Loading..."});if(u)return l.jsxs("div",{children:["An error occurred: ",u.message]});const c=m=>{r(m?"split":"unified")};let f=null;if(t&&s){const m=t.split(`
`),h=s.split(`
`);f=Ie(m,h)}return l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("div",{className:"flex flex-col",children:[l.jsx(I,{htmlFor:"first-lexical-closure",children:"First Version"}),l.jsx(R,{items:d.map((m,h)=>({value:m.lexical_closure,label:h.toString()})),value:t,setValue:o})]}),l.jsxs("div",{className:"flex flex-col",children:[l.jsx(I,{htmlFor:"second-lexical-closure",children:"Second Version"}),l.jsx(R,{items:d.map((m,h)=>({value:m.lexical_closure,label:h.toString()})),value:s,setValue:a})]})]}),f&&l.jsxs(l.Fragment,{children:[l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(se,{id:"diff-view",checked:e==="split",onCheckedChange:c}),l.jsxs(I,{htmlFor:"diff-view",children:[e==="split"?"Split":"Unified"," View"]})]}),l.jsx("div",{className:"flex",children:e==="unified"?l.jsx(Ve,{diffedLines:f}):l.jsx(Re,{diffedLines:f})})]})]})},Be=je("/diff")({component:()=>l.jsx(Fe,{})}),Fe=()=>{const[n,e]=g.useState(""),{isPending:r,error:t,data:o}=W({queryKey:["function_names"],queryFn:async()=>await(await fetch("http://localhost:8000/api/prompt-versions")).json()});return r?l.jsx("div",{children:"Loading..."}):t?l.jsxs("div",{children:["An error occurred: ",t.message]}):l.jsxs("div",{className:"p-2 flex flex-col gap-2",children:[l.jsx(Ne,{variant:"h3",children:"Diff Tool"}),l.jsx(R,{items:o.map(s=>({value:s,label:s})),value:n,setValue:e}),n&&l.jsx(qe,{value:n})]})};export{Be as Route};
