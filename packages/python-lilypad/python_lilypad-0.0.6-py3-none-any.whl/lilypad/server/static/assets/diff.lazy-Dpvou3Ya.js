import{r as b,j as a,P as X,a as Y,B as W,C as K,b as ee,c as ne,d as re,e as se,f as te,g as oe,h as le,i as ae,k as ie,u as Z,L as F,S as ue,l as ce,T as fe}from"./index-BztZUpMs.js";function q({items:n,value:e,setValue:r}){var t;const[s,o]=b.useState(!1);return a.jsxs(X,{open:s,onOpenChange:o,children:[a.jsx(Y,{asChild:!0,children:a.jsxs(W,{variant:"outline",role:"combobox","aria-expanded":s,className:"w-[200px] justify-between",children:[e?(t=n.find(l=>l.value===e))==null?void 0:t.label:"Select item...",a.jsx(K,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),a.jsx(ee,{className:"w-[200px] p-0",children:a.jsxs(ne,{children:[a.jsx(re,{placeholder:"Search item...",className:"h-9"}),a.jsxs(se,{children:[a.jsx(te,{children:"No item found."}),a.jsx(oe,{children:n.map(l=>a.jsxs(le,{value:l.value,onSelect:i=>{r(i===e?"":i),o(!1)},children:[l.label,a.jsx(ae,{className:ie("ml-auto h-4 w-4",e===l.value?"opacity-100":"opacity-0")})]},l.value))})]})]})})]})}function x(){}x.prototype={diff:function(e,r){var s,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},t=o.callback;typeof o=="function"&&(t=o,o={});var l=this;function i(v){return v=l.postProcess(v,o),t?(setTimeout(function(){t(v)},0),!0):v}e=this.castInput(e,o),r=this.castInput(r,o),e=this.removeEmpty(this.tokenize(e,o)),r=this.removeEmpty(this.tokenize(r,o));var u=r.length,d=e.length,c=1,f=u+d;o.maxEditLength!=null&&(f=Math.min(f,o.maxEditLength));var m=(s=o.timeout)!==null&&s!==void 0?s:1/0,h=Date.now()+m,p=[{oldPos:-1,lastComponent:void 0}],g=this.extractCommon(p[0],r,e,0,o);if(p[0].oldPos+1>=d&&g+1>=u)return i(_(l,p[0].lastComponent,r,e,l.useLongestToken));var j=-1/0,w=1/0;function $(){for(var v=Math.max(j,-c);v<=Math.min(w,c);v+=2){var y=void 0,N=p[v-1],L=p[v+1];N&&(p[v-1]=void 0);var I=!1;if(L){var B=L.oldPos-v;I=L&&0<=B&&B<u}var S=N&&N.oldPos+1<d;if(!I&&!S){p[v]=void 0;continue}if(!S||I&&N.oldPos<L.oldPos?y=l.addToPath(L,!0,!1,0,o):y=l.addToPath(N,!1,!0,1,o),g=l.extractCommon(y,r,e,v,o),y.oldPos+1>=d&&g+1>=u)return i(_(l,y.lastComponent,r,e,l.useLongestToken));p[v]=y,y.oldPos+1>=d&&(w=Math.min(w,v-1)),g+1>=u&&(j=Math.max(j,v+1))}c++}if(t)(function v(){setTimeout(function(){if(c>f||Date.now()>h)return t();$()||v()},0)})();else for(;c<=f&&Date.now()<=h;){var D=$();if(D)return D}},addToPath:function(e,r,s,o,t){var l=e.lastComponent;return l&&!t.oneChangePerToken&&l.added===r&&l.removed===s?{oldPos:e.oldPos+o,lastComponent:{count:l.count+1,added:r,removed:s,previousComponent:l.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:r,removed:s,previousComponent:l}}},extractCommon:function(e,r,s,o,t){for(var l=r.length,i=s.length,u=e.oldPos,d=u-o,c=0;d+1<l&&u+1<i&&this.equals(s[u+1],r[d+1],t);)d++,u++,c++,t.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return c&&!t.oneChangePerToken&&(e.lastComponent={count:c,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=u,d},equals:function(e,r,s){return s.comparator?s.comparator(e,r):e===r||s.ignoreCase&&e.toLowerCase()===r.toLowerCase()},removeEmpty:function(e){for(var r=[],s=0;s<e.length;s++)e[s]&&r.push(e[s]);return r},castInput:function(e){return e},tokenize:function(e){return Array.from(e)},join:function(e){return e.join("")},postProcess:function(e){return e}};function _(n,e,r,s,o){for(var t=[],l;e;)t.push(e),l=e.previousComponent,delete e.previousComponent,e=l;t.reverse();for(var i=0,u=t.length,d=0,c=0;i<u;i++){var f=t[i];if(f.removed)f.value=n.join(s.slice(c,c+f.count)),c+=f.count;else{if(!f.added&&o){var m=r.slice(d,d+f.count);m=m.map(function(h,p){var g=s[c+p];return g.length>h.length?g:h}),f.value=n.join(m)}else f.value=n.join(r.slice(d,d+f.count));d+=f.count,f.added||(c+=f.count)}}return t}function H(n,e){var r;for(r=0;r<n.length&&r<e.length;r++)if(n[r]!=e[r])return n.slice(0,r);return n.slice(0,r)}function G(n,e){var r;if(!n||!e||n[n.length-1]!=e[e.length-1])return"";for(r=0;r<n.length&&r<e.length;r++)if(n[n.length-(r+1)]!=e[e.length-(r+1)])return n.slice(-r);return n.slice(-r)}function R(n,e,r){if(n.slice(0,e.length)!=e)throw Error("string ".concat(JSON.stringify(n)," doesn't start with prefix ").concat(JSON.stringify(e),"; this is a bug"));return r+n.slice(e.length)}function M(n,e,r){if(!e)return n+r;if(n.slice(-e.length)!=e)throw Error("string ".concat(JSON.stringify(n)," doesn't end with suffix ").concat(JSON.stringify(e),"; this is a bug"));return n.slice(0,-e.length)+r}function T(n,e){return R(n,e,"")}function V(n,e){return M(n,e,"")}function Q(n,e){return e.slice(0,de(n,e))}function de(n,e){var r=0;n.length>e.length&&(r=n.length-e.length);var s=e.length;n.length<e.length&&(s=n.length);var o=Array(s),t=0;o[0]=0;for(var l=1;l<s;l++){for(e[l]==e[t]?o[l]=o[t]:o[l]=t;t>0&&e[l]!=e[t];)t=o[t];e[l]==e[t]&&t++}t=0;for(var i=r;i<n.length;i++){for(;t>0&&n[i]!=e[t];)t=o[t];n[i]==e[t]&&t++}return t}var z="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",ve=new RegExp("[".concat(z,"]+|\\s+|[^").concat(z,"]"),"ug"),O=new x;O.equals=function(n,e,r){return r.ignoreCase&&(n=n.toLowerCase(),e=e.toLowerCase()),n.trim()===e.trim()};O.tokenize=function(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r;if(e.intlSegmenter){if(e.intlSegmenter.resolvedOptions().granularity!="word")throw new Error('The segmenter passed must have a granularity of "word"');r=Array.from(e.intlSegmenter.segment(n),function(t){return t.segment})}else r=n.match(ve)||[];var s=[],o=null;return r.forEach(function(t){/\s/.test(t)?o==null?s.push(t):s.push(s.pop()+t):/\s/.test(o)?s[s.length-1]==o?s.push(s.pop()+t):s.push(o+t):s.push(t),o=t}),s};O.join=function(n){return n.map(function(e,r){return r==0?e:e.replace(/^\s+/,"")}).join("")};O.postProcess=function(n,e){if(!n||e.oneChangePerToken)return n;var r=null,s=null,o=null;return n.forEach(function(t){t.added?s=t:t.removed?o=t:((s||o)&&U(r,o,s,t),r=t,s=null,o=null)}),(s||o)&&U(r,o,s,null),n};function U(n,e,r,s){if(e&&r){var o=e.value.match(/^\s*/)[0],t=e.value.match(/\s*$/)[0],l=r.value.match(/^\s*/)[0],i=r.value.match(/\s*$/)[0];if(n){var u=H(o,l);n.value=M(n.value,l,u),e.value=T(e.value,u),r.value=T(r.value,u)}if(s){var d=G(t,i);s.value=R(s.value,i,d),e.value=V(e.value,d),r.value=V(r.value,d)}}else if(r)n&&(r.value=r.value.replace(/^\s*/,"")),s&&(s.value=s.value.replace(/^\s*/,""));else if(n&&s){var c=s.value.match(/^\s*/)[0],f=e.value.match(/^\s*/)[0],m=e.value.match(/\s*$/)[0],h=H(c,f);e.value=T(e.value,h);var p=G(T(c,h),m);e.value=V(e.value,p),s.value=R(s.value,c,p),n.value=M(n.value,c,c.slice(0,c.length-p.length))}else if(s){var g=s.value.match(/^\s*/)[0],j=e.value.match(/\s*$/)[0],w=Q(j,g);e.value=V(e.value,w)}else if(n){var $=n.value.match(/\s*$/)[0],D=e.value.match(/^\s*/)[0],v=Q($,D);e.value=T(e.value,v)}}var me=new x;me.tokenize=function(n){var e=new RegExp("(\\r?\\n)|[".concat(z,"]+|[^\\S\\n\\r]+|[^").concat(z,"]"),"ug");return n.match(e)||[]};var k=new x;k.tokenize=function(n,e){e.stripTrailingCr&&(n=n.replace(/\r\n/g,`
`));var r=[],s=n.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(var o=0;o<s.length;o++){var t=s[o];o%2&&!e.newlineIsToken?r[r.length-1]+=t:r.push(t)}return r};k.equals=function(n,e,r){return r.ignoreWhitespace?((!r.newlineIsToken||!n.includes(`
`))&&(n=n.trim()),(!r.newlineIsToken||!e.includes(`
`))&&(e=e.trim())):r.ignoreNewlineAtEof&&!r.newlineIsToken&&(n.endsWith(`
`)&&(n=n.slice(0,-1)),e.endsWith(`
`)&&(e=e.slice(0,-1))),x.prototype.equals.call(this,n,e,r)};var he=new x;he.tokenize=function(n){return n.split(/(\S.+?[.!?])(?=\s+|$)/)};var pe=new x;pe.tokenize=function(n){return n.split(/([{}:;,]|\s+)/)};function P(n){"@babel/helpers - typeof";return P=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(n)}var E=new x;E.useLongestToken=!0;E.tokenize=k.tokenize;E.castInput=function(n,e){var r=e.undefinedReplacement,s=e.stringifyReplacer,o=s===void 0?function(t,l){return typeof l>"u"?r:l}:s;return typeof n=="string"?n:JSON.stringify(J(n,null,null,o),o,"  ")};E.equals=function(n,e,r){return x.prototype.equals.call(E,n.replace(/,([\r\n])/g,"$1"),e.replace(/,([\r\n])/g,"$1"),r)};function J(n,e,r,s,o){e=e||[],r=r||[],s&&(n=s(o,n));var t;for(t=0;t<e.length;t+=1)if(e[t]===n)return r[t];var l;if(Object.prototype.toString.call(n)==="[object Array]"){for(e.push(n),l=new Array(n.length),r.push(l),t=0;t<n.length;t+=1)l[t]=J(n[t],e,r,s,o);return e.pop(),r.pop(),l}if(n&&n.toJSON&&(n=n.toJSON()),P(n)==="object"&&n!==null){e.push(n),l={},r.push(l);var i=[],u;for(u in n)Object.prototype.hasOwnProperty.call(n,u)&&i.push(u);for(i.sort(),t=0;t<i.length;t+=1)u=i[t],l[u]=J(n[u],e,r,s,u);e.pop(),r.pop()}else l=n;return l}var A=new x;A.tokenize=function(n){return n.slice()};A.join=A.removeEmpty=function(n){return n};function xe(n,e,r){return A.diff(n,e,r)}const C=Symbol("placeholder"),ge=n=>{const e=[];let r=0;for(;r<n.length;){const s=n[r];if(s.removed&&r+1<n.length&&n[r+1].added){const o=s.value,t=n[r+1].value,l=Math.max(o.length,t.length);e.push({type:"modified",oldValue:o.concat(Array(l-o.length).fill(C)),newValue:t.concat(Array(l-t.length).fill(C))}),r+=2}else if(s.removed){const o=s.value,t=Array(o.length).fill(C);e.push({type:"removed",oldValue:o,newValue:t}),r++}else if(s.added){const o=s.value,t=Array(o.length).fill(C);e.push({type:"added",oldValue:t,newValue:o}),r++}else e.push({type:"unchanged",oldValue:s.value,newValue:s.value}),r++}return e},ye=({diffedLines:n})=>{const e=ge(n),r=s=>{const o=[];let t=0;const l=[];return e.forEach((i,u)=>{(s==="before"?i.oldValue:i.newValue).forEach((c,f)=>{c!==C?(t++,l.push(a.jsx("div",{className:"text-xs leading-5 text-gray-500 py-[1px]",children:t},`${s}-linenumber-${t}`))):l.push(a.jsx("div",{className:"text-xs leading-5 text-gray-500 py-[1px]",children:" "},`${s}-linenumber-placeholder-${u}-${f}`));const m=c===C?"bg-gray-200":i.type==="modified"?s==="before"?"bg-red-100":"bg-green-100":i.type==="added"&&s==="after"?"bg-green-100":i.type==="removed"&&s==="before"?"bg-red-100":"";o.push(a.jsx("div",{className:`${m} leading-5 px-4 py-[1px] min-h-[22px]`,children:c===null?"":c},`${s}-${u}-${f}`))})}),a.jsx("div",{className:"flex-1 overflow-x-auto",children:a.jsx("code",{className:"!p-0 !bg-transparent",children:a.jsxs("div",{className:"flex",children:[a.jsx("div",{className:"flex-none w-12 text-right pr-2 bg-gray-100 border-r border-gray-300",children:l}),a.jsx("pre",{className:"flex-grow !bg-transparent",children:o})]})})})};return a.jsx("div",{className:"font-mono text-sm border rounded-md overflow-hidden",children:a.jsxs("div",{className:"flex",children:[r("before"),a.jsx("div",{className:"w-px bg-gray-300"}),r("after")]})})},Ce=({diffedLines:n})=>{let e=0,r=0;return a.jsx("div",{className:"font-mono text-sm border rounded-md overflow-hidden",children:a.jsx("code",{className:"!p-0 !bg-transparent",children:a.jsxs("div",{className:"flex",children:[a.jsxs("div",{className:"flex gap-1 w-12 pl-1 bg-gray-100 border-r border-gray-300",children:[a.jsx("div",{children:n.map((s,o)=>!s.added&&!s.removed||s.removed?s.value.map(()=>(e++,a.jsx("div",{className:"py-0.5 text-gray-500",children:e},`before-${e}`))):s.value.map((t,l)=>a.jsx("div",{className:"py-0.5",children:" "},`after-empty-${r+l+1}`)))}),a.jsx("div",{children:n.map((s,o)=>!s.added&&!s.removed||s.added?s.value.map(()=>(r++,a.jsx("div",{className:"py-0.5 text-gray-500",children:r},`after-${r}`))):s.value.map((t,l)=>a.jsx("div",{className:"py-0.5",children:" "},`after-empty-${r+l+1}`)))})]}),a.jsx("pre",{className:"flex-grow !bg-transparent overflow-x-auto",children:n.map((s,o)=>{const t=s.added?"bg-green-100":s.removed?"bg-red-100":void 0,l=s.added?"+":s.removed?"-":" ";return s.value.map((i,u)=>a.jsxs("div",{className:`py-0.5 ${t}`,children:[l," ",i]},u))})})]})})})},je=({value:n})=>{const[e,r]=b.useState("split"),[s,o]=b.useState(""),[t,l]=b.useState(""),{isPending:i,error:u,data:d}=Z({queryKey:["fnParams"],queryFn:async()=>await(await fetch("/llm-fns/names")).json()});if(i)return a.jsx("div",{children:"Loading..."});if(u)return a.jsxs("div",{children:["An error occurred: ",u.message]});const c=m=>{r(m?"split":"unified")};let f=null;if(s&&t){const m=s.split(`
`),h=t.split(`
`);f=xe(m,h)}return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("div",{className:"flex flex-col",children:[a.jsx(F,{htmlFor:"first-lexical-closure",children:"First Version"}),a.jsx(q,{items:d.map((m,h)=>({value:m.lexical_closure,label:h.toString()})),value:s,setValue:o})]}),a.jsxs("div",{className:"flex flex-col",children:[a.jsx(F,{htmlFor:"second-lexical-closure",children:"Second Version"}),a.jsx(q,{items:d.map((m,h)=>({value:m.lexical_closure,label:h.toString()})),value:t,setValue:l})]})]}),f&&a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(ue,{id:"diff-view",checked:e==="split",onCheckedChange:c}),a.jsxs(F,{htmlFor:"diff-view",children:[e==="split"?"Split":"Unified"," View"]})]}),a.jsx("div",{className:"flex",children:e==="unified"?a.jsx(Ce,{diffedLines:f}):a.jsx(ye,{diffedLines:f})})]})]})},Le=ce("/diff")({component:()=>a.jsx(we,{})}),we=()=>{const[n,e]=b.useState(""),{isPending:r,error:s,data:o}=Z({queryKey:["function_names"],queryFn:async()=>await(await fetch("http://localhost:8000/api/prompt-versions")).json()});return r?a.jsx("div",{children:"Loading..."}):s?a.jsxs("div",{children:["An error occurred: ",s.message]}):a.jsxs("div",{className:"p-2 flex flex-col gap-2",children:[a.jsx(fe,{variant:"h3",children:"Diff Tool"}),a.jsx(q,{items:o.map(t=>({value:t,label:t})),value:n,setValue:e}),n&&a.jsx(je,{value:n})]})};export{Le as Route};
