name: Release python package

on:
  push:
    tags:
      - "*"

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: eifinger/setup-rye@v4
        id: setup-rye
        with:
          enable-cache: true
          cache-prefix: 3.9"
      - name: 'Pin python-version 3.9'
        run: rye pin 3.9
      - name: Install dependencies
        if: steps.setup-rye.outputs.cache-hit != 'true'
        run: |
          rye sync --no-lock
      - name: Build package
        run: rye publish --repository taskiq-asyncpg  --username z22092 --token ${{ secrets.PYPI_TOKEN }} --yes
        
      - name: Release package
        run: rye publish --repository taskiq-asyncpg  --username z22092 --token ${{ secrets.PYPI_TOKEN }} --yes 