import{f as X,e as L}from"./index.6e2c534c.js";import"./singletons.1f51f3a9.js";import{w as Q,t as z}from"./scheduler.398aa708.js";import{b as ee,k as te}from"./ProgressBar.svelte_svelte_type_style_lang.ce11150a.js";import{U as F,N as ne,P as re,a as ie,b as B,H as oe,p as C}from"./parse.7d180a0f.js";class v extends Error{constructor(t,n){super(t),this.name="DevalueError",this.path=n.join("")}}function V(e){return Object(e)!==e}const se=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function ae(e){const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null||Object.getOwnPropertyNames(t).sort().join("\0")===se}function fe(e){return Object.prototype.toString.call(e).slice(8,-1)}function ue(e){switch(e){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return e<" "?`\\u${e.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function S(e){let t="",n=0;const i=e.length;for(let r=0;r<i;r+=1){const o=e[r],a=ue(o);a&&(t+=e.slice(n,r)+a,n=r+1)}return`"${n===0?e:t+e.slice(n)}"`}function ce(e,t){const n=[],i=new Map,r=[];for(const s in t)r.push({key:s,fn:t[s]});const o=[];let a=0;function f(s){if(typeof s=="function")throw new v("Cannot stringify a function",o);if(i.has(s))return i.get(s);if(s===void 0)return F;if(Number.isNaN(s))return ne;if(s===1/0)return re;if(s===-1/0)return ie;if(s===0&&1/s<0)return B;const d=a++;i.set(s,d);for(const{key:h,fn:p}of r){const m=p(s);if(m)return n[d]=`["${h}",${f(m)}]`,d}let c="";if(V(s))c=x(s);else switch(fe(s)){case"Number":case"String":case"Boolean":c=`["Object",${x(s)}]`;break;case"BigInt":c=`["BigInt",${s}]`;break;case"Date":c=`["Date","${s.toISOString()}"]`;break;case"RegExp":const{source:p,flags:m}=s;c=m?`["RegExp",${S(p)},"${m}"]`:`["RegExp",${S(p)}]`;break;case"Array":c="[";for(let l=0;l<s.length;l+=1)l>0&&(c+=","),l in s?(o.push(`[${l}]`),c+=f(s[l]),o.pop()):c+=oe;c+="]";break;case"Set":c='["Set"';for(const l of s)c+=`,${f(l)}`;c+="]";break;case"Map":c='["Map"';for(const[l,E]of s)o.push(`.get(${V(l)?x(l):"..."})`),c+=`,${f(l)},${f(E)}`;c+="]";break;default:if(!ae(s))throw new v("Cannot stringify arbitrary non-POJOs",o);if(Object.getOwnPropertySymbols(s).length>0)throw new v("Cannot stringify POJOs with symbolic keys",o);if(Object.getPrototypeOf(s)===null){c='["null"';for(const l in s)o.push(`.${l}`),c+=`,${S(l)},${f(s[l])}`,o.pop();c+="]"}else{c="{";let l=!1;for(const E in s)l&&(c+=","),l=!0,o.push(`.${E}`),c+=`${S(E)}:${f(s[E])}`,o.pop();c+="}"}}return n[d]=c,d}const u=f(e);return u<0?`${u}`:`[${n.join(",")}]`}function x(e){const t=typeof e;return t==="string"?S(e):e instanceof String?S(e.toString()):e===void 0?F.toString():e===0&&1/e<0?B.toString():t==="bigint"?`["BigInt","${e}"]`:String(e)}function le(e){return e.toString().split(/[[\].]+/).filter(t=>t)}function de(e){return e.reduce((t,n)=>{const i=String(n);return typeof n=="number"||/^\d+$/.test(i)?t+=`[${i}]`:t?t+=`.${i}`:t+=i,t},"")}class w extends Error{constructor(t){super(t),Object.setPrototypeOf(this,w.prototype)}}function j(e,t,n){return e[t]=n,"skip"}function pe(e,t){return t.value!==void 0&&typeof t.value!="object"&&t.path.length<e.length}function Re(e,t,n={}){n.modifier||(n.modifier=r=>pe(t,r)?void 0:r.value);const i=Z(e,t,n.modifier);if(i)return n.value===void 0||n.value(i.value)?i:void 0}function Z(e,t,n){if(!t.length)return;const i=[t[0]];let r=e;for(;i.length<t.length;){const a=i[i.length-1],f=n?n({parent:r,key:String(a),value:r[a],path:i.map(u=>String(u)),isLeaf:!1,set:u=>j(r,a,u)}):r[a];if(f===void 0)return;r=f,i.push(t[i.length])}const o=t[t.length-1];return{parent:r,key:String(o),value:r[o],path:t.map(a=>String(a)),isLeaf:!0,set:a=>j(r,o,a)}}function k(e,t,n=[]){for(const i in e){const r=e[i],o=r===null||typeof r!="object",a={parent:e,key:i,value:r,path:n.map(String).concat([i]),isLeaf:o,set:u=>j(e,i,u)},f=t(a);if(f==="abort")return f;if(f==="skip")continue;if(!o){const u=k(r,t,a.path);if(u==="abort")return u}}}async function Fe(e,t,n=[]){for(const i in e){const r=e[i],o=r===null||typeof r!="object",a={parent:e,key:i,value:r,path:n.map(String).concat([i]),isLeaf:o,set:u=>j(e,i,u)},f=await t(a);if(f==="abort")return f;if(f==="skip")break;if(!o){const u=k(r,t,a.path);if(u==="abort")return u}}}function me(e,t){return e===t||e.size===t.size&&[...e].every(n=>t.has(n))}function Be(e,t){const n=new Map;function i(r,o){const a=Z(o,r.path);function f(){n.set(r.path.join(" "),r.path)}r.isLeaf?a?r.value!==a.value&&f():f():a&&(r.value instanceof Date&&a.value instanceof Date&&r.value.getTime()!=a.value.getTime()||r.value instanceof Set&&a.value instanceof Set&&!me(r.value,a.value))&&f()}return k(e,r=>i(r,t)),k(t,r=>i(r,e)),Array.from(n.values())}function ye(e,t,n){for(const i of t){const r=Z(e,i,({parent:o,key:a,value:f})=>((f===void 0||typeof f!="object")&&(o[a]={}),o[a]));r&&(r.parent[r.key]=n)}}function I(e){return"structuredClone"in globalThis?structuredClone(e):C(ce(e))}function O(e){const t=e;let n=!0,i=!1,r=!1,o=!1,a,f;for(;n;)switch(e._def.typeName){case"ZodNullable":i=!0,e=e.unwrap();break;case"ZodDefault":o=!0,f=e._def.defaultValue(),e=e._def.innerType;break;case"ZodOptional":r=!0,e=e.unwrap();break;case"ZodEffects":a||(a=e),e=e._def.schema;break;case"ZodPipeline":e=e._def.out;break;case"ZodBranded":e=e.unwrap();break;default:n=!1}return{zodType:e,originalType:t,isNullable:i,isOptional:r,hasDefault:o,defaultValue:f,effects:a}}function he(e){let t=0;for(let n=0,i=e.length;n<i;n++){const r=e.charCodeAt(n);t=(t<<5)-t+r,t|=0}return t<0&&(t=t>>>0),t.toString(36)}function be(e){return he(D(e))}function D(e){let t="";const n=O(e);switch(n.zodType._def.typeName){case"ZodObject":{for(const[i,r]of Object.entries(n.zodType.shape))t+="ZodObject:"+i+":"+D(r);break}case"ZodArray":{const i=n.zodType;t+="ZodArray:"+D(i.element);break}default:t+=n.zodType._def.typeName}return t}function ge(e,t){const n=we(e);if(n)return n;const i={typeInfo:q(e),defaultEntity:H(e),constraints:K(e,t),keys:Object.keys(e.keyof().Values),hash:be(e),errorShape:Ee(e)};return _e(e,i),i}function _e(e,t){U.set(e,t)}function we(e){return U.get(e)}const U=new WeakMap;function q(e){return J(e,t=>O(t))}function M(e,t,n,i){if(e)return e;const{zodType:r,isNullable:o,isOptional:a,hasDefault:f,defaultValue:u}=i;if(t&&e!==void 0)return e;if(f)return u;if(o)return null;if(!a&&n){if(r._def.typeName=="ZodString")return"";if(r._def.typeName=="ZodNumber")return 0;if(r._def.typeName=="ZodBoolean")return!1;if(r._def.typeName=="ZodArray")return[];if(r._def.typeName=="ZodObject")return H(r);if(r._def.typeName=="ZodSet")return new Set;if(r._def.typeName=="ZodRecord")return{};if(r._def.typeName=="ZodBigInt")return BigInt(0);if(r._def.typeName=="ZodSymbol")return Symbol()}}function H(e){for(;e._def.typeName=="ZodEffects";)e=e._def.schema;if(e._def.typeName!="ZodObject")throw new w("Only Zod schema objects can be used with defaultValues. Define the schema with z.object({ ... }) and optionally refine/superRefine/transform at the end.");const t=e,n=Object.keys(t.keyof().Values),i=q(t);return Object.fromEntries(n.map(r=>{const o=i[r],a=M(void 0,!0,!0,o);return[r,a]}))}function K(e,t){function n(r,o,a){const f={};if(o._def.typeName=="ZodString"){const u=o,s=u._def.checks.filter(c=>c.kind=="regex");s.length>1&&(t==null?void 0:t.multipleRegexps)!==!1&&console.warn(`Field "${r}" has more than one regexp, only the first one will be used in constraints. Set the warnings.multipleRegexps option to false to disable this warning.`);const d=s.length>0&&s[0].kind=="regex"?s[0].regex.source:void 0;d&&(f.pattern=d),u.minLength!==null&&(f.minlength=u.minLength),u.maxLength!==null&&(f.maxlength=u.maxLength)}else if(o._def.typeName=="ZodNumber"){const u=o,s=u._def.checks.filter(c=>c.kind=="multipleOf");s.length>1&&(t==null?void 0:t.multipleSteps)!==!1&&console.warn(`Field "${r}" has more than one step, only the first one will be used in constraints. Set the warnings.multipleSteps option to false to disable this warning.`);const d=s.length>0&&s[0].kind=="multipleOf"?s[0].value:null;u.minValue!==null&&(f.min=u.minValue),u.maxValue!==null&&(f.max=u.maxValue),d!==null&&(f.step=d)}else if(o._def.typeName=="ZodDate"){const u=o;u.minDate&&(f.min=u.minDate.toISOString()),u.maxDate&&(f.max=u.maxDate.toISOString())}else o._def.typeName=="ZodArray"&&(o._def.minLength&&(f.min=o._def.minLength.value),o._def.maxLength&&(f.max=o._def.maxLength.value),o._def.exactLength&&(f.min=f.max=o._def.exactLength.value));return!a.isNullable&&!a.isOptional&&(f.required=!0),Object.keys(f).length>0?f:void 0}function i(r,o){const a=O(o);return o=a.zodType,o._def.typeName=="ZodArray"?i(r,o._def.type):o._def.typeName=="ZodObject"?K(o,t):n(r,o,a)}return J(e,(r,o)=>i(o,r),r=>!!r)}function J(e,t,n){const i=e.keyof().Values;return Object.fromEntries(Object.keys(i).map(r=>[r,t(e.shape[r],r)]).filter(r=>n?n(r[1]):!0))}const A=new WeakMap;function Ee(e){return A.has(e)||A.set(e,T(e)),A.get(e)}function T(e){const t=O(e).zodType;if(t._def.typeName=="ZodObject")return Object.fromEntries(Object.entries(t.shape).map(([n,i])=>[n,T(i)]).filter(n=>n[1]!==void 0));if(t._def.typeName=="ZodArray")return T(t._def.type)??{};if(t._def.typeName=="ZodRecord")return T(t._def.valueType)??{};if(t._def.typeName=="ZodUnion")return t._def.options.reduce((i,r)=>{const o=T(r);return o&&(i={...i??{},...o}),i},void 0)}function P(e,t,n=!0){const i={},r=Object.entries(e);if("_errors"in e&&e._errors.length){if(!t||!n)return e._errors;i._errors=e._errors}for(const[o,a]of r.filter(([f])=>f!=="_errors")){const f=/^\d+$/.test(o);i[o]=P(a,t?f?t:t[o]:void 0,!!(t!=null&&t[o]))}return i}function Ce(e){return W(e,[])}function W(e,t){return Object.entries(e).filter(([,i])=>i!==void 0).flatMap(([i,r])=>{if(Array.isArray(r)&&r.length>0){const o=t.concat([i]);return{path:de(o),messages:r}}else return W(e[i],t.concat([i]))})}function Ue(e,t){e.update(n=>(k(n,i=>{if(!(i.path.length==1&&i.path[0]=="_errors"&&!t.clearFormLevelErrors)&&Array.isArray(i.value))return i.set(void 0)}),t.undefinePath&&ye(n,[t.undefinePath],void 0),n))}const Se=(e,t=0)=>{const n=e.getBoundingClientRect();return n.top>=t&&n.left>=0&&n.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&n.right<=(window.innerWidth||document.documentElement.clientWidth)},Oe=(e,t=1.125,n="smooth")=>{const o=e.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*t);window.scrollTo({left:0,top:o,behavior:n})};var b;(function(e){e[e.Idle=0]="Idle",e[e.Submitting=1]="Submitting",e[e.Delayed=2]="Delayed",e[e.Timeout=3]="Timeout"})(b||(b={}));const Ne=new Set;let R=!1;function qe(e,t,n){let i=b.Idle,r,o,a=!1;const f=Ne;function u(){s(),c(i!=b.Delayed?b.Submitting:b.Delayed),r=window.setTimeout(()=>{r&&i==b.Submitting&&c(b.Delayed)},n.delayMs),o=window.setTimeout(()=>{o&&i==b.Delayed&&c(b.Timeout)},n.timeoutMs),f.add(s)}function s(){clearTimeout(r),clearTimeout(o),r=o=0,f.delete(s),c(b.Idle)}function d(){f.forEach(y=>y()),f.clear()}function c(y){i=y,t.submitting.set(i>=b.Submitting),t.delayed.set(i>=b.Delayed),t.timeout.set(i>=b.Timeout)}const h=e;function p(y){const g=y.target;n.selectErrorText&&g.select()}function m(){n.selectErrorText&&h.querySelectorAll("input").forEach(y=>{y.addEventListener("invalid",p)})}function l(){n.selectErrorText&&h.querySelectorAll("input").forEach(y=>y.removeEventListener("invalid",p))}const E=e;function G(y){return typeof n.autoFocusOnError=="boolean"?n.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(y)}const $=async()=>{if(n.scrollToError=="off")return;const y=n.errorSelector;if(!y)return;await z();let g;if(g=E.querySelector(y),!g)return;g=g.querySelector(y)??g;const N=n.stickyNavbar?document.querySelector(n.stickyNavbar):null;if(typeof n.scrollToError!="string"?g.scrollIntoView(n.scrollToError):Se(g,(N==null?void 0:N.offsetHeight)??0)||Oe(g,void 0,n.scrollToError),!G(navigator.userAgent))return;let _;if(_=g,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(_.tagName)||(_=_.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),_)try{_.focus({preventScroll:!0}),n.selectErrorText&&_.tagName=="INPUT"&&_.select()}catch{}};{m();const y=(g,N=!1)=>{s(),g||setTimeout($),N&&!a&&d()};return Q(()=>{l(),y(!0)}),R||(ee(()=>{a=!0}),te(g=>{g.type!="enter"&&(a=!1,d())}),R=!0),{submitting:()=>{a=!1,u()},completed:y,scrollToFirstError:()=>{setTimeout($)},isSubmitting:()=>i===b.Submitting||i===b.Delayed}}}function Te(e,t,n,i){(n==null||typeof n!="string"&&!Array.isArray(n))&&(i=n,n=t,t=""),i===void 0&&(i={});const r=Array.isArray(n)?n:[n];if(e.errors||(e.errors={}),t===null||t==="")e.errors._errors||(e.errors._errors=[]),e.errors._errors=i.overwrite?r:e.errors._errors.concat(r);else{const o=le(t),a=Z(e.errors,o,({parent:f,key:u,value:s})=>(s===void 0&&(f[u]={}),f[u]));a&&(a.parent[a.key]=Array.isArray(a.value)&&!i.overwrite?a.value.concat(r):r)}return e.valid=!1,X(i.status??400,{form:e})}function ke(e,t,n){const i={},{schemaKeys:r,entityInfo:o}=t;function a(u,s,d){if(n&&n.includes(u))return s;if(!(s&&typeof s!="string"))return f(u,s,d)}for(const u of r){const s=o.typeInfo[u],d=e.getAll(u);if(s.zodType._def.typeName!="ZodArray")i[u]=a(u,d[0],s);else{const c=O(s.zodType._def.type);i[u]=d.map(h=>a(u,h,c))}}function f(u,s,d){const c=M(s,!1,!0,d),h=d.zodType,p=h._def.typeName;if(!s&&p!="ZodBoolean")return c;if(p=="ZodString")return s;if(p=="ZodNumber")return h.isInt?parseInt(s??"",10):parseFloat(s??"");if(p=="ZodBoolean")return(!!(s!="false"&&s)).valueOf();if(p=="ZodDate")return new Date(s??"");if(p=="ZodArray"){const m=O(h._def.type);return f(u,s,m)}else if(p=="ZodBigInt")try{return BigInt(s??".")}catch{return NaN}else if(p=="ZodLiteral"){const m=typeof h.value;if(m==="string")return s;if(m==="number")return parseFloat(s??"");if(m==="boolean")return(!!s).valueOf();throw new w("Unsupported ZodLiteral type: "+m)}else{if(p=="ZodUnion"||p=="ZodEnum"||p=="ZodAny")return s;if(p=="ZodNativeEnum"){const m=h;if(s!==null&&s in m.enum){const l=m.enum[s];if(typeof l=="number")return l;if(l in m.enum)return m.enum[l]}else if(s!==null&&Object.values(m.enum).includes(s))return s;return}else if(p=="ZodSymbol")return Symbol(String(s))}throw p=="ZodObject"?new w(`Object found in form field "${u}". Set the dataType option to "json" and add use:enhance on the client to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`):new w("Unsupported Zod default type: "+h.constructor.name)}return i}function je(e,t){return e.data?e.data:t.hasEffects||t.opts.errors===!0?t.entityInfo.defaultEntity:void 0}function Y(e,t,n){var a;function i(){if(e.has("__superform_json"))try{const f=C(e.getAll("__superform_json").join("")??"");if(typeof f=="object")return f}catch{}return null}const r=i(),o=((a=e.get("__superform_id"))==null?void 0:a.toString())??void 0;return r?{id:o,data:r,posted:!0}:{id:o,data:ke(e,t,n==null?void 0:n.preprocessed),posted:!0}}function Ze(e,t,n){e instanceof URL&&(e=e.searchParams);const i=new FormData;for(const[o,a]of e.entries())i.append(o,a);const r=Y(i,t,n);return r.posted=!1,r}function ve(e,t,n){const{opts:i,entityInfo:r}=t,o=e.posted,a=e.data?i.id??e.id??r.hash:i.id??r.hash;if(e.data){const{opts:f,schemaKeys:u,entityInfo:s,unwrappedSchema:d}=t;if(!n)throw new w("Validation data exists without validation result.");if(n.success)return{id:a,valid:!0,posted:o,errors:{},data:n.data,constraints:s.constraints};{const c=e.data,h=f.errors!==!1?P(n.error.format(),s.errorShape):{},m=d._def.unknownKeys=="passthrough"?{...I(s.defaultEntity),...c}:Object.fromEntries(u.map(l=>[l,l in c?c[l]:I(s.defaultEntity[l])]));return{id:a,valid:!1,posted:o,errors:h,data:m,constraints:s.constraints}}}else{let f,u={};const s=(n==null?void 0:n.success)??!1,{opts:d,entityInfo:c}=t;return n&&(n.success?f=n.data:d.errors===!0&&(u=P(n.error.format(),c.errorShape))),{id:a,valid:s,posted:o,errors:u,data:f??I(c.defaultEntity),constraints:c.constraints}}}function xe(e,t){const n=e;let i=e,r=!1;for(;i._def.typeName=="ZodEffects";)r=!0,i=i._def.schema;if(i._def.typeName!="ZodObject")throw new w("Only Zod schema objects can be used with superValidate. Define the schema with z.object({ ... }) and optionally refine/superRefine/transform at the end.");const o=ge(i,t==null?void 0:t.warnings);return{originalSchema:n,unwrappedSchema:i,hasEffects:r,entityInfo:o,schemaKeys:o.keys,opts:t??{}}}function Me(e,t,n){e&&typeof e=="object"&&"safeParse"in e&&(n=t,t=e,e=null);const i=xe(t,n),r=e instanceof FormData?Y(e,i,n):e instanceof URL||e instanceof URLSearchParams?Ze(e,i):{id:void 0,data:e,posted:!1},o=je(r,i),a=o?i.originalSchema.safeParse(o):void 0;return ve(r,i,a)}async function He(e,t){const n=await e("/api/testruns/"+t).then(r=>(r.ok||L(r.status,r.statusText),r.json())),i=await e("/api/testruns/measurements/"+n.id).then(r=>(r.ok||L(r.status,r.statusText),r.json()));return{run:n,measurements:i}}async function Ke(e,t,n){let i="POST";return t.data.id&&(e+="/"+t.data.id,i="PUT"),await Ie(i,e,t,n)}async function Ie(e,t,n,i){let r="/api/"+t;const o=await fetch(r,{headers:{"Content-Type":"application/json"},method:e,body:JSON.stringify(i||n.data)}),a=await o.json();if(console.log(o),!o.ok)if(o.status==422)"error"in a&&"type"in a.error&&(a.error.type=="unique_violation"?Te(n,a.error.field,"An entry with this value already exists"):console.log("TODO: implement this error type"));else throw new Error("TODO");return a}export{qe as F,w as S,Fe as a,k as b,ye as c,I as d,Ee as e,Ue as f,ce as g,de as h,pe as i,Ce as j,Be as k,Me as l,P as m,Ke as n,Ie as o,Re as p,He as q,le as s,Z as t};
