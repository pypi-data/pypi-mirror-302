[project]
authors = [{name = "Thomas Hartmann", email = "thomas.hartmann@th-ht.de"}]
dependencies = ['attrs', 'pytest-docker', 'python-gitlab']
description = "Pytest Plugin for Gitlab"
name = "pytest-gitlab"
requires-python = ">= 3.9"
dynamic = ["version"]

[project.entry-points.pytest11]
gitlab = "pytest_gitlab.plugin"

[build-system]
build-backend = "hatchling.build"
requires = ["hatchling", "hatch-regex-commit"]

[tool.pixi.project]
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "win-64", "osx-arm64"]

[tool.pixi.dependencies]
hatch = ">=1.12.0,<2"
hatch-vcs = ">=0.4.0,<0.5"
ruff = ">=0.5.6,<0.6"
pre-commit = ">=3.8.0,<4"
pytest = ">=8.3.2,<9"
pytest-cov = ">=5.0.0,<6"
mypy = ">=1.11.1,<2"

[tool.pixi.pypi-dependencies]
pytest-gitlab = { path = ".", editable = true }
id = "*"


[tool.pixi.tasks]
test = "pytest"
lint = "ruff format && ruff check --fix"
lint_ci = "ruff check"
build = { cmd = "hatch build", depends-on = ["lint_ci", "test"] }
version_minor = "hatch version minor && hatch version dev"
version_fix = "hatch version fix && hatch version dev"
check_types = "mypy src"
start_gitlab_docker = "docker compose -f src/pytest_gitlab/docker/docker-compose.yml -p 'pytest-python-gitlab' up -d"

[tool.hatch.version]
source = "regex_commit"
path = "src/pytest_gitlab/__version__.py"
tag_sign = false

[tool.ruff]
line-length = 120

[tool.ruff.lint]
extend-select = [
    'E',
    'W',
    'I',
    'UP',
    'C90',
    'N',
    'PTH',
    'SIM',
    'TCH',
    'PL'
]

ignore = ['UP007']

[tool.ruff.format]
quote-style = 'single'

[tool.mypy]
mypy_path = "src"
disable_error_code = "import-untyped"
disallow_untyped_defs = false

[[tool.mypy.overrides]]
module = "pytest_gitlab.*"
disallow_untyped_defs = true

[tool.pytest.ini_options]
addopts = "--cov=src/pytest_gitlab --cov-report=lcov --keep-containers-running"


