"use strict";(self.webpackChunkjupyter_cassini=self.webpackChunkjupyter_cassini||[]).push([[541],{5959:(e,t,n)=>{n.d(t,{KG:()=>W});var i=n(4901),s=n(4083),a=n(3582),o=n.n(a),r=n(8492),l=n(1182),d=n(6988);const c=l.ServerConnection.makeSettings(),h=o()({baseUrl:r.URLExt.join(c.baseUrl,"jupyter_cassini"),fetch:async e=>{const t=e.url,{method:n,body:i}=e,s={method:n,body:i};try{i instanceof ReadableStream&&(s.body=await e.text())}catch(e){}const a=l.ServerConnection.makeSettings();return l.ServerConnection.makeRequest(t,s,a)}});function u(e,t){const{pathname:n,search:i}=r.URLExt.parse(e.url),s=`${n}${i}, returned ${null==t?void 0:t.reason}, check out browser and server log for more details.`,a=`Cassini server error ${t.reason} at ${n}${i}, caused by: \n\n ${t.message}`;return(0,d.y)(s,a),t.reason}var m;!function(e){e.lookup=function(e){return h.GET("/lookup",{params:{query:{name:e}}}).then((e=>{const{data:t,error:n,response:i}=e;if(t)return e.data;{const e=u(i,n);throw Error(e)}}))},e.tree=function(e){return h.GET("/tree/{ids}",{params:{path:{ids:e.join("/")}}}).then((e=>{const{data:t,error:n,response:i}=e;if(t)return e.data;{const e=u(i,n);throw Error(e)}}))},e.newChild=function(e){return h.POST("/newChild",{body:e}).then((e=>{const{data:t,error:n,response:i}=e;if(t)return e.data;{const e=u(i,n);throw Error(e)}}))},e.openTier=function(e){return h.GET("/open",{params:{query:{name:e}}}).then((e=>{const{data:t,error:n,response:i}=e;if(t)return e.data;{const e=u(i,n);throw Error(e)}}))}}(m||(m={}));var p=n(8026),g=n(4882),v=n(6029),C=n.n(v),w=n(7120),f=n(444),y=n(6386);const b=new f.LabIcon({name:"cassini:home",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><g class="jp-icon3" fill="#616161"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></g></svg>'}),E=e=>{const[t,n]=(0,v.useState)(""),i=e.model;return C().createElement(f.InputGroup,{type:"text",rightIcon:"ui-components:search",placeholder:"Search by name",onChange:e=>{n(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&m.lookup(t).then((e=>{i.currentPath.clear(),i.currentPath.pushAll(e.ids)}))}})};class T extends C().Component{constructor(e){super(e)}render(){const e=[],t=this.props.currentPath,n=this.props.currentTier,i=this.props.onRefreshTree,s=this.props.onTierLaunched,a=this.props.onTierSelected,o=this.props.onCreateChild;for(let n=0;n<t.length-1;n++)e.push(C().createElement("span",null,C().createElement("span",{className:"jp-BreadCrumbs-item",onClick:()=>{t.removeRange(n+1,t.length)}},t.get(n)),C().createElement("span",null,"/")));return C().createElement("div",{className:"cas-CassiniCrumbs-box"},C().createElement("div",{className:"jp-BreadCrumbs jp-FileBrowser-crumbs cas-CassiniCrumbs-row"},C().createElement("span",{className:"jp-BreadCrumbs-home"},C().createElement(f.ToolbarButtonComponent,{icon:b,onClick:()=>t.clear(),tooltip:"Go Home"})),C().createElement("span",null,"/"),e,C().createElement("div",{className:"cas-icon-area"},C().createElement("span",{onClick:()=>i()},C().createElement(f.ToolbarButtonComponent,{icon:f.refreshIcon,onClick:()=>i(),tooltip:"Refresh tree (will fetch changes from server)"})))),C().createElement("div",{className:"jp-BreadCrumbs jp-FileBrowser-crumbs cas-CassiniCrumbs-row"},C().createElement("span",{className:"cas-tier-name"},null==n?void 0:n.name),C().createElement("span",null,"/"),C().createElement("span",null,C().createElement(f.ToolbarButtonComponent,{icon:f.addIcon,className:"jp-BreadCrumbs-home jp-ToolbarButtonComponent-icon",onClick:()=>{n&&o(n)},tooltip:`Add new child of ${null==n?void 0:n.name}`})),C().createElement("div",{className:"cas-icon-area"},C().createElement(f.ToolbarButtonComponent,{icon:f.launcherIcon,className:"jp-BreadCrumbs-home jp-ToolbarButtonComponent-icon",onClick:()=>{n&&s(n)},tooltip:`Open ${null==n?void 0:n.name}`}),C().createElement("span",null,C().createElement(f.ToolbarButtonComponent,{icon:f.caretRightIcon,className:"jp-BreadCrumbs-home jp-ToolbarButtonComponent-icon",onClick:()=>{n&&a([...t],n.name)},enabled:Boolean(null==n?void 0:n.metaPath),tooltip:`Preview ${null==n?void 0:n.name}`})))))}}class M extends C().Component{constructor(e){super(e)}openContextMenu(e){const t=new Set([...this.props.additionalColumns,...this.props.childMetas]);if(!t.size)return;e&&(e.preventDefault(),e.stopPropagation());const n=new w.CommandRegistry;for(const e of t){const t=this.props.additionalColumns.has(e)?f.checkIcon:void 0;n.addCommand(e,{label:e,icon:t,execute:t=>this.setState(((t,n)=>{const i=n.additionalColumns;return i.has(e)?(i.delete(e),this.props.onAdditionalColumnsSet(i),{additionalColumns:i}):(i.add(e),this.props.onAdditionalColumnsSet(i),{additionalColumns:i})}))})}const i=new g.Menu({commands:n});i.addItem({command:"Add Meta",type:"separator"});for(const e of t)i.addItem({command:e});e&&i.open(e.clientX,e.clientY)}render(){const e=this.props.onTierSelected,t=this.props.onTierLaunched,n=this.props.onCreateChild,i=this.openContextMenu.bind(this),s=this.props.additionalColumns;return C().createElement("div",{"data-jp-suppress-context-menu":!0},C().createElement(S,{currentTier:this.props.currentTier,currentPath:this.props.currentPath,children:this.props.children,onTierLaunched:t,onTierSelected:e,onCreateChild:n,onSelectMetas:i,additionalColumns:s}))}}function S(e){const t=e.onTierLaunched,n=e.onTierSelected,i=e.onCreateChild,s=e.currentPath,a=e.currentTier,[o,r]=C().useState([{id:"started",desc:!0}]),l=(0,v.useMemo)((()=>Object.entries(e.children)),[e.children,e.additionalColumns]),d=(0,y.createColumnHelper)(),c=(()=>{let i=[d.accessor(((e,t)=>e[1].name),{id:"name",header:"Name",size:45,cell:e=>{let t;try{t=l[e.row.index][0]}catch(e){t=null}return C().createElement("span",{className:"cas-tier-name jp-BreadCrumbs-item",onClick:()=>t?s.push(t):null},C().createElement("span",null,e.getValue()))}}),d.accessor(((e,t)=>e[1].started||null),{id:"started",header:"Started",size:50,cell:e=>{const t=e.getValue();return t&&C().createElement("span",null,C().createElement("span",null,t.toLocaleDateString()))}}),d.accessor(((e,t)=>e[1].info||""),{id:"info",header:"Info",cell:e=>{const t=e.getValue();return C().createElement("span",null,C().createElement("span",null,t))}}),d.accessor(((e,t)=>e[1].outcome||""),{id:"outcome",header:"Outcome",cell:e=>{const t=e.getValue();return C().createElement("span",null,C().createElement("span",null,t))}})];for(const t of e.additionalColumns)i.push(d.accessor(((e,n)=>{var i;const s=null===(i=e[1])||void 0===i?void 0:i.additionalMeta;if(s)return s[t]}),{id:t,header:t,cell:e=>C().createElement("span",null,C().createElement("span",null,e.getValue()))}));return i=i.concat([d.display({id:"addColumn",header:()=>C().createElement("span",{onClick:t=>e.onSelectMetas(t)},C().createElement(f.ToolbarButtonComponent,{icon:f.editIcon,tooltip:"Edit columns"})),enableResizing:!1,size:20}),d.display({id:"actions",header:"",enableResizing:!1,size:40,cell:e=>{var i;let o;try{o=l[e.row.index][1]}catch(e){o=null}const r=l[e.row.index][1],d=l[e.row.index][0],c={...r,ids:[...s,d]};return C().createElement("div",{className:"cas-row-icon-area"},C().createElement("span",null,C().createElement(f.ToolbarButtonComponent,{icon:f.caretRightIcon,onClick:()=>{o&&n([...s,d],c.name)},enabled:Boolean("notebook"===(null===(i=a.childClsInfo)||void 0===i?void 0:i.tierType)),tooltip:`Preview ${c.name}`})),C().createElement("span",null,C().createElement(f.ToolbarButtonComponent,{icon:f.launcherIcon,onClick:()=>{l&&t(c)},tooltip:`Open ${c.name}`})))}})]),i})(),h=(0,y.useReactTable)({data:l,columns:c,onSortingChange:r,getCoreRowModel:(0,y.getCoreRowModel)(),getSortedRowModel:(0,y.getSortedRowModel)(),columnResizeMode:"onChange",state:{sorting:o}});return C().createElement("div",null,C().createElement("h1",null,e.currentTier.name),C().createElement("table",{className:"cas-ChildrenTable-table"},C().createElement("thead",{onContextMenu:t=>e.onSelectMetas(t)},C().createElement("tr",null,h.getFlatHeaders().map((e=>{var t;return C().createElement("th",{key:e.id,className:["addColumns","launch","select"].includes(e.id)?"":"jp-DirListing-headerItem jp-id-name",style:{width:e.getSize()/h.getCenterTotalSize()*100+"%"}},C().createElement("span",{className:e.column.getCanSort()?"cursor-pointer select-none":"",onClick:e.column.getToggleSortingHandler()},(0,y.flexRender)(e.column.columnDef.header,e.getContext()),null!==(t={asc:C().createElement(f.caretUpIcon.react,{tag:"span"}),desc:C().createElement(f.caretDownIcon.react,{tag:"span"})}[e.column.getIsSorted()])&&void 0!==t?t:null),e.column.getCanResize()?C().createElement("div",{onMouseDown:e.getResizeHandler(),onTouchStart:e.getResizeHandler(),className:"cas-table-resizer"}):null)})))),C().createElement("tbody",null,h.getRowModel().rows.map((e=>C().createElement("tr",{className:"cas-ChildrenTable-row"},e.getVisibleCells().map((e=>C().createElement("td",{key:e.id},(0,y.flexRender)(e.column.columnDef.cell,e.getContext())))))))),C().createElement("tfoot",null,C().createElement("span",null,C().createElement("tr",null,C().createElement("td",{colSpan:3},C().createElement(f.ToolbarButtonComponent,{icon:f.addIcon,onClick:()=>i(e.currentTier),tooltip:`Create new child of ${e.currentTier.name}`,enabled:Boolean(e.currentTier.childClsInfo)})))))))}class x extends s.ReactWidget{constructor(e,t,n,i){super(),this.model=e,this.currentPath=e.currentPath,this.currentTier=e.current,this.onTierSelected=t,this.onTierLaunched=n,this.onCreateChild=i,this.addClass("cas-TierBrowser"),e.changed.connect(this.handleModelChanged,this)}get tierChildren(){var e,t;return(null===(t=null===(e=this.model)||void 0===e?void 0:e.current)||void 0===t?void 0:t.children)||{}}get childMetas(){return this.model.childMetas}handleModelChanged(e,t){switch(t.type){case"current":this.currentTier=t.current;break;case"path":this.currentPath=t.path;break;case"children":this.additionalColumns=e.additionalColumns}this.update()}handleAdditionalColumnsSet(e){const t=new Set(e);this.model.additionalColumns.clear();for(const e of t)this.model.additionalColumns.add(e);this.additionalColumns=t,this.update()}handleRefreshTree(){this.model.refresh(),this.update()}render(){if(!this.currentTier)return C().createElement("div",null,C().createElement("a",null,"Loading"));const e=e=>{this.onCreateChild(e).then((()=>this.model.refresh()))};return C().createElement("div",{style:{height:"100%",overflow:"auto"}},C().createElement(E,{model:this.model}),C().createElement(T,{currentPath:this.currentPath,currentTier:this.currentTier,onRefreshTree:this.handleRefreshTree.bind(this),onTierSelected:this.onTierSelected,onTierLaunched:this.onTierLaunched,onCreateChild:e}),C().createElement(M,{currentTier:this.currentTier,currentPath:this.currentPath,children:this.tierChildren,childMetas:this.childMetas,additionalColumns:this.additionalColumns,onAdditionalColumnsSet:this.handleAdditionalColumnsSet.bind(this),onTierSelected:this.onTierSelected,onTierLaunched:this.onTierLaunched,onCreateChild:e}))}}var k=n(5770),_=n(8667);class P extends g.SplitPanel{constructor(e){super();const t=e||[];this.id=`cas-container-${t}`;const n=this.model=new p.dP;console.log(this);const i=this.browser=new x(n,((e,t)=>this.previewTier(t)),this.launchTier,(e=>(0,_.D)(e)));this.addWidget(i),g.SplitPanel.setStretch(i,1);const s=this.viewer=new k.R7;this.addWidget(s),g.SplitPanel.setStretch(s,0),this.setRelativeSizes([5,3]),W.treeManager.get(t).then((e=>{e&&(n.currentPath.clear(),n.currentPath.pushAll(t),this.previewTier(e.name))}))}previewTier(e){W.tierModelManager.get(e).then((e=>{e instanceof p.Gy&&(this.viewer.model=e)}))}launchTier(e){W.launchTier(e)}onResize(){}}var I=n(6270),B=n.n(I),N=n(5673),R=n.n(N);class V{constructor(){this._changed=new i.Signal(this),this.cache={},this.nameCache={}}get changed(){return this._changed}initialize(){return this.fetchTierData([]).then((e=>e))}get(e,t=!1){if(t)return this.fetchTierData(e);let n=this.cache;for(const t of e){const i=null==n?void 0:n.children;if(void 0===i)return this.fetchTierData(e);if(n=i[t],void 0===n)return this.fetchTierData(e)}return void 0===(null==n?void 0:n.children)?this.fetchTierData(e):new Promise((e=>e(n)))}async lookup(e){if(Object.keys(this.nameCache).includes(e))return Promise.resolve(this.nameCache[e]);const t=await m.lookup(e);return this.get(t.ids)}cacheTreeData(e,t){let n=this.cache;for(const t of e){if(!n)break;let e=n.children;void 0===e&&(e=n.children={}),void 0===e[t]&&(e[t]={}),n=e[t]}return Object.assign(n,t),this.nameCache[t.name]=n,this._changed.emit({ids:e,data:t}),n}fetchTierData(e){return m.tree(e).then((t=>{const n=(0,d.Ks)(t,e);return this.cacheTreeData(e,n)}))}}class D{constructor(){this.cache={}}get(e,t){const n=Object.keys(this.cache).includes(e);return n&&!t?Promise.resolve(this.cache[e]):m.lookup(e).then((t=>{if(n){const n=this.cache[e];return n instanceof p.Gy&&"notebook"===t.tierType&&n.refresh(t),n}return this._insertNewTierModel(e,t)}))}_insertNewTierModel(e,t){let n;switch(t.tierType){case"notebook":n=new p.Gy(t);break;case"folder":n=new p.kU(t)}return this.cache[e]=n,n}}const W=new class{constructor(){this.treeManager=new V,this.tierModelManager=new D,this.ready=new Promise(((e,t)=>{this.resolveReady=e,this.rejectReady=t})),this.ajv=new(B()),R()(this.ajv),this.ajv.addKeyword("x-cas-field")}async initialize(e,t,n,i,s){return this.app=e,this.contentService=t,this.contentFactory=n,this.rendermimeRegistry=i,this.commandRegistry=s,this.treeManager.initialize().then((()=>this.resolveReady(!0))).catch((()=>((0,d.y)("Cassini can't find your project. You must explicitly launch jupyter lab with project.launch() or set CASSINI_PROJECT."),this.rejectReady(!1)))),this.ready}async launchTierBrowser(e){await this.ready;const t=`cassini-browser-${e}`;if(e&&Array.from(this.app.shell.widgets()).map((e=>e.id)).includes(t))return void this.app.shell.activateById(t);const n=new P(e),i=new s.MainAreaWidget({content:n});i.id=t,i.title.label="Cassini Browser",i.title.closable=!0,i.isAttached||this.app.shell.add(i,"main"),this.app.shell.activateById(i.id)}get launchTierBrowserCommand(){return async e=>this.launchTierBrowser.bind(this)()}launchTier(e){e.notebookPath?this.app.commands.execute("docmanager:open",{path:e.notebookPath}):m.openTier(e.name).then((e=>{}))}newChild(e,t){return m.newChild(t).then((t=>this.treeManager.fetchTierData(e.ids)))}}},8026:(e,t,n)=>{n.d(t,{Gy:()=>c,dP:()=>h,kU:()=>d});var i=n(4901),s=n(5911),a=n(3189),o=n(4083),r=n(5959),l=n(6988);class d{constructor(e){this.name=e.name,this.ids=e.ids,this.children=e.children?(0,l.et)(e.children):null}}class c{constructor(e){this._changed=new i.Signal(this),this.name=e.name,this.ids=e.ids,this.notebookPath=e.notebookPath,this.metaSchema=e.metaSchema,this.publicMetaSchema=c.createPublicMetaSchema(this.metaSchema),this.metaValidator=r.KG.ajv.compile(this.metaSchema),this._children=e.children?(0,l.et)(e.children):null,r.KG.treeManager.changed.connect(((e,t)=>{JSON.stringify(t.ids)===JSON.stringify(this.ids)&&(this._children=t.data.children,this._changed.emit({type:"children"}))}),this),this._isDisposed=!1,this._required=[];const t=this.metaFile=new a.Context({manager:r.KG.contentService,factory:new a.TextModelFactory,path:e.metaPath});if(t.model.contentChanged.connect((()=>this._changed.emit({type:"meta"})),this),t.model.stateChanged.connect(((e,t)=>{"dirty"===t.name&&this._changed.emit({type:"dirty"})}),this),this._required.push(t.initialize(!1)),e.hltsPath){const t=this._hltsFile=new a.Context({manager:r.KG.contentService,factory:new a.TextModelFactory,path:e.hltsPath});t.model.contentChanged.connect((()=>{this._changed.emit({type:"hlts"})}),this),this._required.push(t.initialize(!1))}this.ready.then((()=>this._changed.emit({type:"ready"})))}static createPublicMetaSchema(e){const t=structuredClone(e),n=Object.keys(t.properties);for(const e of n){const n=t.properties[e];"core"!==n["x-cas-field"]&&"private"!==n["x-cas-field"]||delete t.properties[e]}return t}get children(){return this._children}get hltsFile(){return this._hltsFile}get changed(){return this._changed}get ready(){return Promise.all(this._required).then((()=>this))}get isDisposed(){return this._isDisposed}get treeData(){return r.KG.treeManager.get(this.ids)}get meta(){var e;return(null===(e=this.metaFile)||void 0===e?void 0:e.isReady)?this.metaFile.model.toJSON():{}}updateMeta(e){var t;if(this.metaValidator(e))return null===(t=this.metaFile)||void 0===t||t.model.fromJSON(e),!0;{const t=this.metaValidator.errors&&this.metaValidator.errors[0];if(!t)return!1;const n=t.instancePath.split("/")[1],i=e[n];return o.Notification.error(`Cassini Error - ${n} ${t.message}, got: ${JSON.stringify(i)}`),!1}}get additionalMeta(){const e={},t=this.meta,n=this.metaSchema.properties;for(const i in t)n&&n[i]&&["core","private"].includes(n[i]["x-cas-field"]||"")||(e[i]=t[i]);return e}setMetaValue(e,t){const n=this.meta;n[e]=t;const i=this.updateMeta(n);return this._changed.emit({type:"meta"}),i}removeMeta(e){const t=this.meta;delete t[e],this.updateMeta(t),this._changed.emit({type:"meta"})}get description(){return this.meta.description||""}set description(e){this.setMetaValue("description",e)}get conclusion(){return this.meta.conclusion||""}set conclusion(e){this.setMetaValue("conclusion",e)}get started(){return new Date(this.meta.started)}get dirty(){var e;return(null===(e=this.metaFile)||void 0===e?void 0:e.model.dirty)||!1}get hltsOutputs(){if(void 0===this.hltsFile)return[];const e=[],t=this.hltsFile.model.toJSON();for(const n in t){const i=t[n];for(const t in i){const n=i[t];e.push({output_type:"display_data",...n})}}return e}save(){var e,t;return Promise.all([null===(e=this.metaFile)||void 0===e?void 0:e.save(),null===(t=this.hltsFile)||void 0===t?void 0:t.save()]).then()}revert(){var e,t;return Promise.all([null===(e=this.metaFile)||void 0===e?void 0:e.revert(),null===(t=this.hltsFile)||void 0===t?void 0:t.revert()]).then()}refresh(e){var t;if(e.hltsPath&&(null===(t=this.hltsFile)||void 0===t?void 0:t.localPath)!==e.hltsPath){const t=this._hltsFile=new a.Context({manager:r.KG.contentService,factory:new a.TextModelFactory,path:e.hltsPath});t.model.contentChanged.connect((()=>{this._changed.emit({type:"hlts"})}),this),this._required.push(t.initialize(!1))}const n=e.children?(0,l.et)(e.children):null;return n!==this.children&&(this._children=n,this._changed.emit({type:"children"})),Promise.all([this.ready,this.revert()])}dispose(){var e;this.isDisposed||(this.metaFile.dispose(),null===(e=this.hltsFile)||void 0===e||e.dispose(),i.Signal.clearData(this))}}class h{constructor(){this._changed=new i.Signal(this),this.currentPath=new s.ObservableList,this.treeManager=r.KG.treeManager,this._current=null,this.currentPath.changed.connect((e=>{this._changed.emit({type:"path",path:e}),this.treeManager.get(this.sCurrentPath).then((e=>{this._current=e,this._changed.emit({type:"current",current:e}),(null==e?void 0:e.children)&&this._changed.emit({type:"children",children:e.children})}))}),this),r.KG.treeManager.changed.connect(((e,{ids:t,data:n})=>{var i;t.toString()===this.sCurrentPath.toString()&&(null===(i=this.current)||void 0===i?void 0:i.children)&&this._changed.emit({type:"refresh"})}),this),this._additionalColumnsStore={additionalColumns:new Set,children:{}}}get changed(){return this._changed}get current(){return this._current}get childMetas(){var e;const t=null===(e=this.current)||void 0===e?void 0:e.children,n=new Set;if(t)for(const e of Object.values(t))for(const t of Object.keys(e.additionalMeta||{}))n.add(t);return n}get additionalColumns(){let e=this._additionalColumnsStore;for(const t of this.currentPath){let n=e.children[t];n||(n=e.children[t]={additionalColumns:new Set,children:{}}),e=n}return e.additionalColumns}get sCurrentPath(){return Array.from(this.currentPath)}refresh(){return this.treeManager.fetchTierData(this.sCurrentPath)}}},3430:(e,t,n)=>{n.d(t,{$c:()=>c,Bf:()=>h,IF:()=>u,Jv:()=>C,LP:()=>d,aZ:()=>m,bM:()=>w,hi:()=>v,lL:()=>g,ny:()=>p,y9:()=>l});var i=n(4882),s=n(4083),a=n(4848),o=n(5959);class r extends i.Widget{get elem(){return"input"}get inputType(){return"text"}get dirty(){return this._dirty}constructor(e){super(),this._dirty=!1,this.addClass("jp-Input-Dialog"),this.addClass("cas-dialogue-input");const{label:t}=e;if(this.input=document.createElement(this.elem),this.input instanceof HTMLInputElement&&this.inputType&&(this.input.type=this.inputType),this.input.classList.add("jp-mod-styled"),this.input.id="jp-dialog-input-id",void 0!==t){const e=document.createElement("label");e.textContent=t,e.htmlFor=this.input.id,this.node.appendChild(e)}this.node.appendChild(this.input),this.input.addEventListener("input",this)}handleEvent(e){"input"===e.type&&(this._dirty=!0)}undefinedIfClean(e){return this.dirty?e:void 0}}class l extends r{get inputType(){return"checkbox"}constructor(e){super(e),this.addClass("jp-Input-Boolean-Dialog"),this.input.checked=!!e.value}getValue(){return this.undefinedIfClean(this.input.checked)}_setValue(e){this.input.checked=e,this.input.dispatchEvent(new Event("input"))}}class d extends r{get inputType(){return"number"}constructor(e){super(e),this.input.value=e.value?e.value.toString():"0"}getValue(){return this.input.value?this.undefinedIfClean(Number(this.input.value)):this.undefinedIfClean(Number.NaN)}_setValue(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))}}class c extends r{get inputType(){return"text"}constructor(e){super(e),this.input.value=e.text?e.text:"",e.placeholder&&(this.input.placeholder=e.placeholder),this._initialSelectionRange=Math.min(this.input.value.length,Math.max(0,this.input.value.length))}onAfterAttach(e){super.onAfterAttach(e),this._initialSelectionRange>0&&this.input.value&&this.input.setSelectionRange(0,this._initialSelectionRange)}getValue(){return this.undefinedIfClean(this.input.value)}_setValue(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))}}class h extends r{get inputType(){return"password"}constructor(e){super(e),this.input.value=e.text?e.text:"",e.placeholder&&(this.input.placeholder=e.placeholder)}onAfterAttach(e){super.onAfterAttach(e),this.input.value&&this.input.select()}getValue(){return this.undefinedIfClean(this.input.value)}_setValue(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))}}class u extends r{get inputType(){return"list"}constructor(e){super(e),this._editable=e.editable||!1;let t,n=e.current||0;if("number"==typeof n&&(t=Math.max(0,Math.min(n,e.items.length-1)),n=""),this.list=document.createElement("select"),e.items.forEach(((e,i)=>{const s=document.createElement("option");i===t&&(s.selected=!0,n=e),s.value=e,s.textContent=e,this.list.appendChild(s)})),e.editable){const t=document.createElement("datalist");t.id="input-dialog-items",t.appendChild(this.list),this.input.value=n,this.input.setAttribute("list",t.id),e.placeholder&&(this.input.placeholder=e.placeholder),this.node.appendChild(t)}else this.input.remove(),this.node.appendChild(s.Styling.wrapSelect(this.list));this.list.addEventListener("input",this)}getValue(){return this._editable?this.undefinedIfClean(this.input.value):this.undefinedIfClean(this.list.value)}_setValue(e){this._editable?this.input.value=e:this.list.value=e,this.input.dispatchEvent(new Event("input"))}}class m extends r{get elem(){return"textarea"}get inputType(){return null}constructor(e){super(e),e.text&&(this.input.value=e.text)}getValue(){return this.undefinedIfClean(this.input.value)}_setValue(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))}}class p extends r{get inputType(){return"date"}constructor(e){super(e),e.value&&!isNaN(e.value.getTime())&&(this.input.value=e.value.toISOString().slice(0,10))}getValue(){return this.undefinedIfClean(new Date(this.input.value))}_setValue(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))}}class g extends r{get inputType(){return"datetime-local"}constructor(e){super(e),e.value&&!isNaN(e.value.getTime())&&(this.input.value=e.value.toISOString().split(".")[0])}getValue(){return this.undefinedIfClean(new Date(this.input.value+"Z"))}_setValue(e){this.input.value=e,this.input.dispatchEvent(new Event("input"))}}class v extends r{get elem(){return"div"}constructor(e){var t;super(e);const n=this.editor=new a.CodeEditorWrapper({model:new a.CodeEditor.Model({mimeType:"application/json"}),factory:o.KG.contentFactory.newInlineEditor,editorOptions:{config:{lineNumbers:!1},inline:!0}});this.input.appendChild(n.node),n.model.sharedModel.setSource(null!==(t=JSON.stringify(e.value))&&void 0!==t?t:""),this.editor.model.sharedModel.changed.connect(((e,t)=>{this.input.dispatchEvent(new Event("input"))}))}getValue(){try{return this.undefinedIfClean(JSON.parse(this.editor.model.sharedModel.getSource()))}catch(e){return}}_setValue(e){this.editor.model.sharedModel.setSource(e)}}class C extends c{constructor(e){super(e),this.nameTemplate=e.nameTemplate,this.previewBox=document.createElement("span"),this.previewBox.className="cas-floating-preview",this.node.appendChild(this.previewBox),this.previewBox.textContent=`Preview: ${this.nameTemplate.replace("{}","?")}`}handleEvent(e){if(super.handleEvent(e),"input"===e.type){const e=this.input.value;this.previewBox.textContent=`Preview: ${this.nameTemplate.replace("{}",e)}`}}}class w{constructor(e,t,n){this.wrappedInput=e,this.validator=t,this.postProcessor=null!=n?n:null,this.input.addEventListener("input",this)}get input(){return this.wrappedInput.input}getValue(){return this.postProcessor?this.postProcessor(this.wrappedInput.getValue()):this.wrappedInput.getValue()}validate(){const e=this.getValue();let t;return t=void 0!==e&&this.validator(e),t?(this.wrappedInput.input.classList.remove("cas-invalid-id"),t):(this.wrappedInput.input.classList.add("cas-invalid-id"),t)}handleEvent(e){"input"===e.type&&this.validate()}}},9797:(e,t,n)=>{n.d(t,{Ed:()=>m,Zp:()=>u,fd:()=>c});var i=n(4882),s=n(8492),a=n(8026),o=n(6045),r=n(4901),l=n(5959),d=n(3430);function c(e,t,n){const i=function(e,t,n){if(e.enum&&e.type){const i=e.enum;return new d.IF({label:n,current:i.indexOf(t),items:i,title:"",editable:!1})}switch(e.type){case"string":{const i=t;if(!e.format)return new d.$c({label:n,text:i,title:""});switch(e.format){case"date":return new d.ny({label:n,value:i?new Date(i):void 0,title:""});case"date-time":return new d.lL({label:n,value:i?new Date(i):void 0,title:""});case"password":return new d.Bf({label:n,text:i,title:""});default:return new d.$c({label:n,text:i,title:""})}}case"number":{const e=t;return new d.LP({label:n,value:e,title:""})}case"integer":{const e=t;return new d.LP({label:n,value:e,title:""})}case"boolean":{const e=t;return new d.y9({label:n,value:e,title:""})}case"array":{const e=t;return new d.hi({label:n,value:e,title:""})}case"object":{const e=t;return new d.hi({label:n,value:e,title:""})}default:{const e=t;return new d.hi({label:n,value:e,title:""})}}}(e,t,n);let s,a;return s=i instanceof d.hi?e=>void 0!==e:t=>l.KG.ajv.validate(e,t),a=i instanceof d.ny?e=>void 0===e||isNaN(e.getTime())?void 0:e.toISOString().slice(0,10):i instanceof d.lL?e=>void 0===e||isNaN(e.getTime())?void 0:e.toISOString():void 0,new d.bM(i,s,a)}const h=()=>{};class u extends i.Panel{constructor(e,t){super(),this._onlyDisplay=t||null,this._model=e,this.table=new o.H({properties:{},additionalProperties:{}},{},h,h),this.addWidget(this.table),this.handleNewModel(null,e)}get model(){return this._model}set model(e){const t=this._model;this._model=e,this.handleNewModel(t,e)}get onlyDisplay(){return this._onlyDisplay}set onlyDisplay(e){this._onlyDisplay=e,this.model&&this.handleModelChange(this.model,{type:"onlyDisplay",values:e})}handleModelChange(e,t){switch(t.type){case"ready":case"onlyDisplay":case"meta":{const{schema:e,values:t}=this.getSchemaValues();this.table.values=t,this.table.schema=e;break}}this.table.update()}handleNewModel(e,t){if(e&&r.Signal.disconnectBetween(e,this),!t)return this.table.values={},this.table.schema={properties:{},additionalProperties:{}},this.table.handleRemoveMetaKey=h,this.table.handleSetMetaValue=h,void this.table.update();this.table.handleSetMetaValue=((e,n)=>{n&&t.setMetaValue(e,n)}).bind(this),this.table.handleRemoveMetaKey=(e=>{t.removeMeta(e)}).bind(this),this.handleModelChange(t,{type:"meta"}),t.changed.connect(this.handleModelChange,this)}getSchemaValues(){return this.model?null===this.onlyDisplay?{schema:this.model.publicMetaSchema,values:this.model.additionalMeta}:u._getSelectMeta(this.model.publicMetaSchema,this.model.additionalMeta,this.onlyDisplay):{schema:{properties:{},additionalProperties:{}},values:{}}}static _getSelectMeta(e,t,n){const i={properties:{},additionalProperties:e.additionalProperties,$defs:e.$defs},s={};for(const a of n)Object.keys(e.properties).includes(a)&&(i.properties[a]=e.properties[a]),s[a]=t[a];return{schema:i,values:s}}}class m extends i.Panel{constructor(e){super(),this._modelChanged=new r.Signal(this),this._mimeType=e.mimeType;const t=e.resolver;this._path=t.path,this.fetchModel=l.KG.tierModelManager.get(this.name).then((e=>{if(e&&!(e instanceof a.kU))return this.model=e,this.model})),this.fetchModel.then((e=>{e&&(this.editor=new u(e),this.addWidget(this.editor))}))}get modelChanged(){return this._modelChanged}get model(){return this._model}set model(e){this._model=e,this._modelChanged.emit(e)}ready(){return this.fetchModel.then((e=>null==e?void 0:e.ready.then()))}get path(){return this._path}get name(){return s.PathExt.basename(this.path,".ipynb")}renderModel(e){let t=e.data[this._mimeType].values;return"string"==typeof t&&(t=[t]),this.ready().then((()=>{this.editor.onlyDisplay=t||null})),Promise.resolve()}}},6045:(e,t,n)=>{n.d(t,{H:()=>c});var i=n(6029),s=n.n(i),a=n(6386),o=n(4083),r=n(444),l=n(9797);function d(e){const t=e.onMetaUpdate,n=e.onRemoveMeta,l=e.onNewMetaKey,d=(0,i.useMemo)((()=>e.metas),[e.metas]);d.sort(((e,t)=>e.name.toLowerCase()>t.name.toLowerCase()?1:-1));const c=(0,a.createColumnHelper)(),h=(()=>{const e=[c.accessor("name",{cell:e=>e.getValue(),header:"Name"}),c.accessor("editor",{cell:e=>{const t=e.getValue()().wrappedInput;return s().createElement("span",{ref:e=>{e&&!t.isAttached&&e.appendChild(t.node),null===e&&t.isAttached&&t.dispose()}})},header:"Value"})];if(t||n){const i=c.display({id:"edit",cell:e=>{const i=d[e.row.index];return s().createElement("span",{className:"cas-row-icon-area"},n&&s().createElement(r.ToolbarButtonComponent,{icon:r.closeIcon,onClick:()=>n(i.name),tooltip:`Delete (${i.name})`}),t&&s().createElement(r.ToolbarButtonComponent,{icon:r.checkIcon,onClick:()=>t(i.name,i.editor().getValue()),tooltip:"Apply changes"}))}});e.push(i)}return e})(),u=(0,a.useReactTable)({columns:h,data:d,getCoreRowModel:(0,a.getCoreRowModel)()});return s().createElement("div",null,s().createElement("table",{className:"cas-ChildrenTable-table"},s().createElement("thead",null,s().createElement("tr",null,u.getFlatHeaders().map((e=>s().createElement("th",{key:e.id},(0,a.flexRender)(e.column.columnDef.header,e.getContext())))))),s().createElement("tbody",null,u.getRowModel().rows.map((e=>s().createElement("tr",null,e.getVisibleCells().map((e=>s().createElement("td",{key:e.id},(0,a.flexRender)(e.column.columnDef.cell,e.getContext())))))))),l&&s().createElement("tfoot",null,s().createElement("span",null,s().createElement("tr",null,s().createElement("td",{colSpan:3},s().createElement(r.ToolbarButtonComponent,{icon:r.addIcon,onClick:()=>o.InputDialog.getText({title:"New meta attribute",label:"name"}).then((e=>{e.value&&l&&l(e.value)})),tooltip:"Add a new meta attribute"})))))))}class c extends o.ReactWidget{constructor(e,t,n,i,s=!0){super(),this.schema=e,this.values=t,this.handleSetMetaValue=n,this.handleRemoveMetaKey=i,this.allowNewMetaKeys=s,this.inputs={}}handleNewMetaKey(e){this.values[e]=void 0,this.update()}getValue(){const e={};for(const[t,n]of Object.entries(this.inputs))e[t]=n.getValue();return e}render(){this.inputs={};const e=[],t=new Set(Object.keys(this.values));for(const[n,i]of Object.entries(this.schema.properties)){const s=this.values[n];t.delete(n);const a=(0,l.fd)(i,s,void 0);this.inputs[n]=a,e.push({name:n,editor:()=>a})}for(const n of t){const t=this.values[n],i=this.schema.additionalProperties;i.$ref&&(i.$defs=this.schema.$defs);const s=(0,l.fd)(i,t,void 0);this.inputs[n]=s,e.push({name:n,editor:()=>s})}const n=this.handleNewMetaKey.bind(this);return s().createElement(d,{metas:e,onMetaUpdate:this.handleSetMetaValue,onNewMetaKey:this.allowNewMetaKeys?n:void 0,onRemoveMeta:this.handleRemoveMetaKey})}}},8541:(e,t,n)=>{n.d(t,{d3:()=>w,sy:()=>v});var i=n(4882),s=n(8492),a=n(444),o=n(5959),r=n(5770),l=n(8026),d=n(6029),c=n.n(d),h=n(6386),u=n(4083);function m(e){const t=e.onChildLaunch,n=e.onChildView,i=(0,d.useMemo)((()=>e.children),[e.children]),s=(0,h.createColumnHelper)(),o=(()=>{const e=[s.display({id:"name",cell:e=>{const[t,n]=i[e.row.index];return c().createElement("span",{className:"cas-tier-name"},n.name)},header:"Name"}),s.display({id:"info",cell:e=>{const[t,n]=i[e.row.index];return c().createElement("span",null,n.info)},header:"Info"}),s.display({id:"actions",cell:e=>{const[s,o]=i[e.row.index];return c().createElement("div",{className:"cas-row-icon-area"},c().createElement(a.ToolbarButtonComponent,{icon:a.launchIcon,onClick:()=>t(o),tooltip:`Open ${o.name}`}),c().createElement(a.ToolbarButtonComponent,{icon:a.treeViewIcon,onClick:()=>n(o,s),tooltip:`Show ${o.name} in browser`}))}})];return e})(),r=(0,h.useReactTable)({columns:o,data:i,getCoreRowModel:(0,h.getCoreRowModel)()});return c().createElement("table",{className:"cas-ChildrenTable-table"},c().createElement("thead",null,c().createElement("tr",null,r.getFlatHeaders().map((e=>c().createElement("th",{key:e.id},(0,h.flexRender)(e.column.columnDef.header,e.getContext())))))),c().createElement("tbody",null,r.getRowModel().rows.map((e=>c().createElement("tr",null,e.getVisibleCells().map((e=>c().createElement("td",{key:e.id},(0,h.flexRender)(e.column.columnDef.cell,e.getContext())))))))),c().createElement("tfoot",null,c().createElement("span",null,c().createElement("tr",null,c().createElement("td",{colSpan:3},c().createElement(a.ToolbarButtonComponent,{icon:a.addIcon,onClick:()=>e.onCreateChild(),tooltip:"Create new child"}))))))}class p extends u.ReactWidget{constructor(e,t,n,i){super(),this.addClass("cas-ChildrenSummaryWidget"),this._data=e,this.onChildLaunch=t,this.onChildView=n,this.onCreateChild=i}get data(){return this._data}set data(e){this._data=e,this.update()}render(){return c().createElement(m,{children:this.data,onChildLaunch:this.onChildLaunch,onChildView:this.onChildView,onCreateChild:this.onCreateChild})}}var g=n(8667);class v extends i.BoxPanel{constructor(e){var t;super(),this.model=e,this.addClass("cas-TierNotebookHeader");const n=this.toolbar=new a.Toolbar,s=this.nameLabel=new i.Widget;s.node.textContent=this.model.name,n.addItem("name",s);const o=new i.Widget;o.node.textContent=(null===(t=this.model.started)||void 0===t?void 0:t.toLocaleDateString())&&"",n.addItem("started",o);const r=new a.ToolbarButton({icon:a.treeViewIcon,onClick:()=>{this.showInBrowser()},tooltip:`Show ${this.model.name} in browser`});n.addItem("show in browser",r),this.addWidget(n),i.BoxPanel.setStretch(n,0),this.model.changed.connect((()=>this.onContentChanged()),this)}static attachToNotebook(e,t){const n=s.PathExt.basename(t.path,".ipynb");return o.KG.tierModelManager.get(n).then((n=>{if(n&&n instanceof l.Gy){const i=new v(n);return e.contentHeader.addWidget(i),t.saveState.connect(((e,t)=>{"started"===t&&i.model.save()}),this),i}}))}showInBrowser(){o.KG.launchTierBrowser(this.model.ids)}onContentChanged(){this.model.dirty?this.nameLabel.node.textContent=this.model.name+"*":this.nameLabel.node.textContent=this.model.name}}class C extends i.Panel{constructor(e){super(),this.addClass("cas-TierNotebookHeader"),this.model=e;const t=document.createElement("h1");t.textContent=this.model.name,this.addWidget(new i.Widget({node:t}));const n=this.content=new i.SplitPanel;n.addClass("cas-TierNotebookHeader-content");const s=new i.Panel;s.addClass("cas-TierNotebookHeader-content-child");const a=document.createElement("h3");a.textContent="Description",s.addWidget(new i.Widget({node:a}));const l=this.descriptionEditor=new r.cE(this.model.description,!0);l.contentChanged.connect(((e,t)=>{this.model.description=t}),this),s.addWidget(l),n.addWidget(s);const d=new i.Panel;d.addClass("cas-TierNotebookHeader-content-child");const c=document.createElement("h3");c.textContent="Conclusion",d.addWidget(new i.Widget({node:c}));const h=this.conclusionEditor=new r.cE(this.model.conclusion,!0);h.contentChanged.connect(((e,t)=>{this.model.conclusion=t}),this),d.addWidget(h),n.addWidget(d),this.addWidget(n);const u=new i.Panel;u.addClass("cas-TierNotebookHeader-content-child");const m=document.createElement("h3");m.textContent="Children",u.addWidget(new i.Widget({node:m}));const v=this.model.children,C=this.childrenSummary=new p(v?Object.entries(v):[],(e=>e&&o.KG.launchTier(e)),((e,t)=>o.KG.launchTierBrowser([...this.model.ids,t])),(()=>this.model.treeData.then((e=>e&&(0,g.D)(e)))));u.addWidget(C),n.addWidget(u),this.model.changed.connect(this.onModelChanged,this)}showInBrowser(){o.KG.launchTierBrowser(this.model.ids)}onModelChanged(e,t){switch(t.type){case"ready":{this.descriptionEditor.source=this.model.description,this.conclusionEditor.source=this.model.conclusion;const e=this.model.children;this.childrenSummary.data=e?Object.entries(e):[];break}case"meta":this.descriptionEditor.source=this.model.description,this.conclusionEditor.source=this.model.conclusion;break;case"children":{const e=this.model.children;this.childrenSummary.data=e?Object.entries(e):[],this.childrenSummary.update();break}}this.update()}}class w extends i.Panel{constructor(e){super(),this._mimeType=e.mimeType;const t=e.resolver;this._path=t.path,this.fetchModel=o.KG.tierModelManager.get(this.name).then((e=>{if(e&&!(e instanceof l.kU))return this.model=e,this.addWidget(new C(this.model)),this.model}))}ready(){return this.fetchModel.then((e=>null==e?void 0:e.ready.then()))}get path(){return this._path}get name(){return s.PathExt.basename(this.path,".ipynb")}renderModel(e){return this._mimeType,Promise.resolve()}}},8667:(e,t,n)=>{n.d(t,{D:()=>h});var i=n(4882),s=n(4083),a=n(5959),o=n(3430),r=n(8026),l=n(6045);class d extends i.Widget{constructor(e){super(),this.parentName=e.name;const t=this.layout=new i.PanelLayout,n=e.ids.length?e.name:"",s=new RegExp(`^${e.childClsInfo.idRegex}$`),a=n+e.childClsInfo.namePartTemplate,d=this.identifierInput=new o.bM(new o.Jv({title:"Identitifier",label:"Identifier",nameTemplate:a}),(t=>!!t&&s.test(t)&&!Object.keys(e.children).includes(t)));if(this.subInputs={id:d},t.addWidget(d.wrappedInput),"notebook"===e.childClsInfo.tierType){const n=this.descriptionInput=new o.aZ({title:"Da Description",label:"Description"});t.addWidget(n);const i=this.templateSelector=new o.IF({title:"template",label:"Template",items:e.childClsInfo.templates||[]});t.addWidget(i),this.subInputs.description=n,this.subInputs.template=i;const s=this.metaTable=new l.H(r.Gy.createPublicMetaSchema(e.childClsInfo.metaSchema),Object.fromEntries(e.childClsInfo.additionalMetaKeys.map((e=>[e,void 0]))),void 0,void 0,!1);t.addWidget(s)}}getValue(){const e={};for(const t in this.subInputs){const n=this.subInputs[t].getValue();void 0!==n&&(e[t]=n)}return e.parent=this.parentName,this.metaTable&&Object.assign(e,this.metaTable.getValue()),e}}class c extends s.Dialog{_evtKeydown(e){13===e.keyCode&&document.activeElement instanceof HTMLTextAreaElement||super._evtKeydown(e)}}function h(e){var t;const n=new d(e);return new c({title:`Create New ${null===(t=e.childClsInfo)||void 0===t?void 0:t.name}`,body:n}).launch().then((t=>t.value?a.KG.newChild(e,t.value):Promise.resolve(null)))}},5770:(e,t,n)=>{n.d(t,{R7:()=>m,cE:()=>u});var i=n(4882),s=n(4901),a=n(444),o=n(9649),r=n(4848),l=n(5959),d=n(8026),c=n(9797);function h(e,t){const n=document.createElement(e);return n.textContent=t,new i.Widget({node:n})}class u extends i.Panel{constructor(e,t){super(),this._contentChanged=new s.Signal(this),this.addClass("cas-MarkdownEditor");const n=document.createElement("div");n.className="cas-icon-area",n.classList.add("jp-ToolbarButtonComponent-icon"),this.node.appendChild(n),this.editButton=new a.ToolbarButton({icon:a.editIcon,onClick:()=>{this.setRendered(!1)},tooltip:"Edit"}),this.checkButton=new a.ToolbarButton({icon:a.checkIcon,onClick:()=>{this.setRendered(!0)},tooltip:"Apply changes"});const o=this.output=new i.Widget({node:document.createElement("div")});o.addClass("cas-markdown-editor-content"),this.addWidget(o),this.editor=new r.CodeEditorWrapper({model:new r.CodeEditor.Model({mimeType:"text/x-markdown"}),factory:l.KG.contentFactory.newInlineEditor,editorOptions:{config:{lineNumbers:!1}}}),this.editor.addClass("cas-markdown-editor-content"),this.source=e,this.addWidget(this.editor),o.node.ondblclick=e=>{this.setRendered(!1)},this.editor.node.addEventListener("focusout",(e=>{this.setRendered(!0)})),this.onAfterAttach=()=>{i.Widget.attach(this.editButton,n),i.Widget.attach(this.checkButton,n),this.setRendered(t)}}get contentChanged(){return this._contentChanged}get source(){return this.editor.model.sharedModel.source}set source(e){this.editor.model.sharedModel.source=e,this.onStateChanged()}get rendered(){return this._rendered}setRendered(e){this._rendered=e,this.onStateChanged(),!0===e&&this._contentChanged.emit(this.source)}onStateChanged(){if(this.rendered){const e=l.KG.rendermimeRegistry;(0,o.renderMarkdown)({host:this.output.node,source:this.source,trusted:!1,sanitizer:e.sanitizer,resolver:e.resolver,linkHandler:e.linkHandler,latexTypesetter:e.latexTypesetter,shouldTypeset:!0,markdownParser:e.markdownParser}),this.editor.setHidden(!0),this.checkButton.setHidden(!0),this.output.setHidden(!1),this.editButton.setHidden(!1)}else this.editor.setHidden(!1),this.checkButton.setHidden(!1),this.output.setHidden(!0),this.editButton.setHidden(!0)}}class m extends i.BoxPanel{constructor(e=null){super(),this._modelChanged=new s.Signal(this),this.modelChanged.connect(((e,t)=>this.handleNewModel(t)),this),this.model=e,this.addClass("cas-tier-widget");const t=this.toolbar=new a.Toolbar,n=new a.ToolbarButton({icon:a.saveIcon,onClick:()=>{this.save()},tooltip:"Save changes to disk"}),o=new a.ToolbarButton({icon:a.refreshIcon,onClick:()=>{this.refresh()},tooltip:"Fetch from disk"}),r=this.launchButton=new a.ToolbarButton({icon:a.launchIcon,tooltip:"Open Tier"});t.addItem("save",n),t.addItem("refresh",o),t.addItem("launch",r),this.addWidget(t),i.BoxPanel.setStretch(t,0);const l=new i.Panel;l.addClass("cas-tier-widget-content"),this.addWidget(l),i.BoxPanel.setStretch(l,1),this.tierTitle=h("h1","Name"),l.addWidget(this.tierTitle);const d=new i.Panel;d.node.title="description-section",d.addWidget(h("h2","Description"));const m=this.descriptionCell=new u("",!0);d.addWidget(m),l.addWidget(d);const p=new i.Panel;p.node.title="highlights-section",p.addWidget(h("h2","Highlights")),this.highlightsBox=new i.Panel,this.highlightsBox.addClass("cas-tier-highlights-box"),p.addWidget(this.highlightsBox),l.addWidget(p);const g=new i.Panel;g.node.title="conclusion-section",g.addWidget(h("h2","Conclusion"));const v=this.concCell=new u("",!0);g.addWidget(v),l.addWidget(g);const C=new i.Panel;C.node.title="meta-section",C.addWidget(h("h2","Meta"));const w=this.metaView=new c.Zp(this.model);C.addWidget(w),l.addWidget(C)}get modelChanged(){return this._modelChanged}get model(){return this._model}set model(e){const t=this._model;this._model=e,this._modelChanged.emit({old:t,new:e})}handleModelChanged(e,t){switch(t.type){case"ready":this.descriptionCell.source=e.description,this.concCell.source=e.conclusion,this.renderHighlights(e),this.tierTitle.node.textContent=e.name+(e.dirty?"*":"");break;case"meta":this.descriptionCell.source=e.description,this.concCell.source=e.conclusion;break;case"hlts":this.renderHighlights(e);break;case"dirty":this.tierTitle.node.textContent=e.name+(e.dirty?"*":"")}}handleNewModel(e){if(e.old&&(s.Signal.disconnectBetween(e.old,this),s.Signal.disconnectSender(this.descriptionCell),s.Signal.disconnectSender(this.concCell)),!e.new)return;const t=e.new;console.log(t),t.changed.connect(this.handleModelChanged,this),this.descriptionCell.contentChanged.connect(((e,n)=>{t.description=n}),this),this.concCell.contentChanged.connect(((e,n)=>{t.conclusion=n}),this),this.launchButton.onClick=()=>{l.KG.launchTier(t)},this.metaView.model=t,this.handleModelChanged(t,{type:"ready"})}renderHighlights(e){if(!this.highlightsBox)return!0;for(const e of Array.from(this.highlightsBox.widgets))e.dispose();const t=l.KG.rendermimeRegistry.clone({resolver:new o.RenderMimeRegistry.UrlResolver({contents:l.KG.contentService.contents,path:e.notebookPath})});for(const n of e.hltsOutputs){const e=n.data;for(const n of Object.keys(e)){const i=t.createRenderer(n);this.highlightsBox.addWidget(i),i.renderModel(new o.MimeModel({data:e,trusted:!1}))}}}save(){this.model&&this.model.save()}refresh(){var e;l.KG.tierModelManager.get((null===(e=this.model)||void 0===e?void 0:e.name)||"",!0).then((e=>{e instanceof d.Gy&&(this.model=e)}))}}},6988:(e,t,n)=>{n.d(t,{Ks:()=>a,et:()=>s,y:()=>o});var i=n(4083);function s(e){const t={};for(const n of Object.keys(e)){const i=e[n],{started:s,...a}=i,o={started:null,...a};i.started&&(o.started=new Date(i.started)),t[n]=o}return t}function a(e,t){const{started:n,children:i,...a}=e,o={started:null,children:{},ids:t,...a};return n&&(o.started=new Date(n)),o.children=s(e.children),o}function o(e,t){i.Notification.error("Cassini - "+e),t||(t=e),console.warn("Cassini - "+t)}}}]);